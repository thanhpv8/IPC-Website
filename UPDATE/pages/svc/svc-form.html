<div class='col-md-4'>
    <form>
        <!-- First row -->
        <div class='row'>
            <div class="col-sm-6" style="padding:2px;">
                <div class="form-group">
                    <label for="svc_ckid_txt">CKID</label>
                    <label for="svc_tn_cbx" class="svc-form">TN:</label>
                    <input type="checkbox" id="svc_tn_cbx" style="margin-top:2px" checked>
                    <input style="display:none" type="text" class="form-control svc-form svc-ckid-txt">
                    <input id="svc_ckid" type="text" class="form-control svc-form svc-ckid-tn" placeholder="555-555-5555"  data-inputmask='"mask": "999-999-9999"' data-mask=""/>
                </div>
            </div>
                
            <div class="col-sm-2 " style="padding: 2px;">
                <div class="form-group">
                    <label for="svc_cls_sel">CLS</label>
                    <select class="form-control svc-form" id="svc_cls_sel" style="padding: 2px">
                        <option></option>
                        <option>BUS</option>
                        <option>RES</option>
                    </select>
                </div>
            </div>
        
            <div class="col-sm-2 " style="padding: 2px ;">
                <div class="form-group">
                    <label for="svc_adsr_sel">ADSR</label>
                    <select class="form-control svc-form" id="svc_adsr_sel" style="padding: 2px">
                        <option>N</option>
                        <option>Y</option>
                    </select>
                </div>  
            </div>   
        
            
            <div class="col-sm-2 " style="padding: 2px ;">
                <button id="svc_findCkid_btn" style="text-align:right; margin-top:25px;" class="btn btn-primary svc-form">View</button>
            </div> 
        </div>

        <!-- Second row -->
        <div class="row">
            <div class="col-sm-6 " style="padding: 2px ;">
                <div class="form-group">
                    <label for="svc_ordno_txt">ORDNO</label>
                    <input type="text" class="form-control svc-form" id="svc_ordno_txt">
                </div>
            </div>
            
            <div class="col-sm-2 " style="padding: 2px ;">
                <div class="form-group">
                    <label for="svc_mlo_sel">MLO</label>
                    <select class="form-control svc-form" id="svc_mlo_sel" style="padding: 2px">
                        <option>N</option>
                        <option>Y</option>
                    </select>
                </div>
            </div> 
        
            <div class="col-sm-2 " style="padding: 2px ;">
                <div class="form-group">
                    <label for="svc_prot_sel">PROT</label>
                    <select class="form-control svc-form" id="svc_prot_sel" style="padding: 2px">
                        <option></option>
                        <option>SSM</option>
                        <option>SSP</option>
                    </select>
                </div>
            </div>
        
            <input type="hidden" class="form-control svc-form" id="svc_date_date" readonly>
            
            <div class="col-sm-2 " style="padding: 2px ;">
                <button id="svc_findOrd_btn" style="text-align:right; margin-top:25px;" class="btn btn-primary svc-form">View</button>
            </div> 
        </div>

        <!-- Third row-->
        <div class="row" id="svc-form-date-div">

            <div class="col-sm-5" style="padding:2px;">
                <div class="form-group">
                    <label>DD:</label>
                    <div class="input-group date">
                        <div class="input-group-addon">
                            <i class="fa fa-calendar"></i>
                        </div>
                        <input type="text" class="form-control pull-right svc-form datepicker" id="svc_dd_date">
                    </div>
                </div>
            </div>
            <div class="col-sm-5" style="padding:2px;">
                <div class="form-group">
                    <label>FDD:</label>
                    <div class="input-group date">
                        <div class="input-group-addon">
                            <i class="fa fa-calendar"></i>
                        </div>
                        <input type="text" class="form-control pull-right svc-form datepicker" id="svc_fdd_date">
                    </div>
                </div>
            </div>
        </div>  
        
        <!-- Fourth row -->
        <div class="row">
            <div class="col-sm-2 " style="padding: 2px ;">
                <div class="form-group">
                    <label for="svc_ctyp_sel">CONTYP</label>
                    <select class="form-control svc-form" id="svc_ctyp_sel" style="padding: 2px">
                        <option></option>
                        <option>GEN</option>
                        <option>LPBK</option>
                        <option>MLPT</option>
                    </select>
                </div>
            </div>  

            <div class="col-sm-5 " style="padding: 2px ;">
                <div class="form-group">
                    <label for="svc_ffac_txt" style="float:left">FAC(X)</label>
                    &nbsp;&nbsp;&nbsp;
                    <a id="svc_ffacSearch_btn" style="height: 25px">Search</a>
                    <input type="text" class ="form-control svc-form" id="svc_ffac_txt">

                    <div class="col-sm-4" style="padding-left: 0px; padding-right: 0px">
                        <label for="svc_ftypX_txt">FTYP</label>
                        <input type="text" class="form-control svc-form" id="svc_ftypX_txt" style="padding: 2px">
                    </div>
                    <div class="col-sm-4" style="padding-left: 0px; padding-right: 0px">
                        <label for="svc_ortX_txt">ORT</label>
                        <input type="text" class="form-control svc-form" id="svc_ortX_txt" style="padding: 2px">
                    </div>
                    <div class="col-sm-4" style="padding-left: 0px; padding-right: 0px">
                        <label for="svc_portX_txt">PORT</label>
                        <input type="text" class="form-control svc-form" id="svc_portX_txt" style="padding: 2px">
                    </div>
                    
                </div>
            </div> 
            <div class="col-sm-5 " style="padding: 2px ;">
                <div class="form-group">
                    <label for="svc_tfac_txt" style="float:left">FAC(Y)</label>
                    &nbsp;&nbsp;&nbsp;
                    <a id="svc_tfacSearch_btn" style="height: 25px">Search</a>
                    <input type="text" class ="form-control svc-form" id="svc_tfac_txt">

                    <div class="col-sm-4" style="padding-left: 0px; padding-right: 0px">
                        <label for="svc_ftypY_txt">FTYP</label>
                        <input type="text" class="form-control svc-form" id="svc_ftypY_txt" style="padding: 2px">
                    </div>
                    <div class="col-sm-4" style="padding-left: 0px; padding-right: 0px">
                        <label for="svc_ortY_txt">ORT</label>
                        <input type="text" class="form-control svc-form" id="svc_ortY_txt" style="padding: 2px">
                    </div>
                    <div class="col-sm-4" style="padding-left: 0px; padding-right: 0px">
                        <label for="svc_portY_txt">PORT</label>
                        <input type="text" class="form-control svc-form" id="svc_portY_txt" style="padding: 2px">
                    </div>

                </div>
            </div> 

            <div id="svc_facSearch" ftyp="" class="col-sm-12" style="display:none; padding: 0px">
                <div style="margin:0 0 1px 0;">
                    <div class="box box-primary">
                        <table id="svc_facSearch_table" class="table table-striped table-bordered table-hover" style="width:100%;">
                            <thead>
                                <tr>
                                    <th>FAC</th>
                                    <th>FTYP</th>
                                    <th>ORT</th>
                                    <th>PSTA</th>
                                    <th>PORT</th>
                                </tr>
                            </thead>
                        </table>
                    </div>
                </div>
            </div>
        
        </div>

        <!-- Last row -->
        <div class="row">
            <div class="col-sm-3 " style="padding: 2px ;"> 
                <div class="form-group">
                    <label for="svc_act_sel">ACTION</label>    
                    <select class="form-control" id="svc_act_sel" style="padding: 2px" >
                        <option></option>
                        <option>UPDATE_CKT</option>
                        <option>CONNECT</option>
                        <option>DISCONNECT</option>
                        <option>CHANGE</option>
                    </select>
                </div>
            </div>
            
            <div class="col-sm-8 " style="padding: 2px ;">
                <button id="svc_clear_btn" type="button" class="btn btn-primary svc-form" style="margin-top:25px;">Clear</button>
                <!-- 3 input fields to be hidden after testing -->
                <input class="svc-form" id="svc_cktId_num" type="hidden" style="width:50px">
                <input class="svc-form" id="svc_cktconId_num" type="hidden" style="width:50px">
                <input class="svc-form" id="svc_cktconIdx_num" type="hidden" style="width:50px">
            </div>
        </div>

    </form>

</div>
<!--  style for this dataTable -->
<style>

</style>
<script>
    var svcFacSearchDatatable = $("#svc_facSearch_table").DataTable({
        "dom": 'frtip', 
        "data": [],
        "pageLength": 3,
        "columns": [
            {"data":"fac"},
            {"data":"ftyp"},
            {"data":"ort"},
            {"data":"psta"},
            {"data":"port"},
        ],
        "order": [[ 0, "desc" ]]
    });
    
    function clearSearchArea(){
        $(".svc-facSearch-form").val("");
        svcFacSearchDatatable.clear().draw();
        $("#svc_facSearch").attr("ftyp","");
        $("#svc_facSearch").hide();
    }

    function searchFac(){
        $.ajax({
            type: 'POST',
            url: ipcDispatch,
            data: {
                "api":    "ipcFacilities",
                "act":    "findFac",
                "user":   user.uname,
                "grp":    user.grp,
                "ugrp":   user.ugrp,
                "fac":     "%",
                "psta":    "",
            },
            dataType: 'json'
        }).done(function(data) {
            if (data.rslt == 'fail') {
                clearErrors();
                inputError($("#svc_act_sel"),data.reason);
            }
            else {
                let res = [];
                let ftyp = $("#svc_facSearch").attr("ftyp");
                if (data.hasOwnProperty('rows')) {
                    for (var i=0; i<data.rows.length; i++) {
                        if(data.rows[i].port == "") {
                            continue;
                        }
                        if(ftyp == "X")
                            if(data.rows[i].port.split('-')[2] == 'X')
                                res.push(data.rows[i]);
                            else 
                                continue;
                        else {
                            if(data.rows[i].port.split('-')[2] == 'Y')
                                res.push(data.rows[i]);
                            else 
                                continue;
                        }
                    }
                }
                if (res.length == 0) {
                    inputError($('#svc_act_sel'),'No Record Found');
                }
                svcFacSearchDatatable.search("").draw();
                svcFacSearchDatatable.clear().draw();
                svcFacSearchDatatable.rows.add(res);
                svcFacSearchDatatable.columns.adjust().draw();
            }
        });
    }

    function resetSvcPage() {
        $(".svc-form").val("");
        $("#svc_cls_sel").val("RES");
        $("#svc_adsr_sel").val("N");
        $("#svc_mlo_sel").val("N");
        clearErrors();
        $("#svc_act_sel").val("");
        svcQueryCkid();
        svcOrdDatatable.clear().draw();
        svcCktconDatatable.clear().draw();
        clearSearchArea();
        $("#svc_cktArea").show();
        $("#svc_ordArea").hide();
        $("#svc_cktconArea").hide();
    }

    $(document).ready(function(){

        $("#svc_dd_date").datepicker({
            orientation: "bottom"
        });

        $("#svc_fdd_date").datepicker({
            orientation: "bottom"
        });

        $(".svc-ckid-tn").inputmask();

        $(".menu-item[page_id='svc-page']").click(function() {
            resetSvcPage();
        });

        $("#svc_clear_btn").click(function(e){
            resetSvcPage();
        });

        $("#svc_ffacSearch_btn").click(function(e){
            clearErrors();
            $("#svc_act_sel").val("");
            let ftyp = $("#svc_facSearch").attr("ftyp");
            svcFacSearchDatatable.clear().draw();
            if(ftyp == "X") {
                $("#svc_facSearch").hide();
                $("#svc_facSearch").attr("ftyp","");
            }
            else {
                $("#svc_facSearch").show();
                $("#svc_facSearch").attr("ftyp","X");
            }
            searchFac();
        })

        $("#svc_tfacSearch_btn").click(function(e){
            $("#svc_act_sel").val("");
            clearErrors();
            let ftyp = $("#svc_facSearch").attr("ftyp");
            svcFacSearchDatatable.clear().draw();
            if(ftyp == "Y") {
                $("#svc_facSearch").hide();
                $("#svc_facSearch").attr("ftyp","");
            }
            else {
                $("#svc_facSearch").show();
                $("#svc_facSearch").attr("ftyp","Y");
            }
            searchFac();
        })
    
        $("#svc_act_sel").change(function(){
            clearErrors();

            let act = $("#svc_act_sel").val();
            let cktId = $("#svc_cktId_num").val();
            let idx = $("#svc_cktconIdx_num").val();
            
            clearSvcModal();
            if (act == "") {
                return;
            } else {
                if(act == "CONNECT") {
                    $('.svcModal-form').prop('disabled', false);
                    $("#svcModal_newConForm").show();
                    $("#svcModal_discConForm").hide();
                    $("#svcModal_changeConForm").hide();
                }
                else {
                    if(cktId == "" || cktId == 0) {
                        inputError($('#svc_act_sel'),'Please select a CKT from the LIST OF CKTs');
                        return;
                    }
                    if(act == "UPDATE_CKT") {
                        $('.svcModal-form').prop('disabled', false);
                        $("#svcModal_newConForm").hide();
                        $("#svcModal_discConForm").hide();
                        $("#svcModal_changeConForm").hide();
                    }
                    else if(act == "DISCONNECT") {
                        if(idx == "" || idx == 0) {
                            inputError($('#svc_act_sel'),'Please select a CON from the LIST OF CONNECTIONS');
                            return;
                        }
                        $('.svcModal-form').prop('disabled', true);
                        $("#svcModal_newConForm").hide();
                        $("#svcModal_discConForm").show();
                        $("#svcModal_changeConForm").hide();

                    }
                    else if(act == "CHANGE") {
                        if(idx == "" || idx == 0) {
                            inputError($('#svc_act_sel'),'Please select a CON from the LIST OF CONNECTIONS');
                            return;
                        }
                        $('.svcModal-form').prop('disabled', false);
                        $("#svcModal_newConForm").hide();
                        $("#svcModal_discConForm").hide();
                        $("#svcModal_changeConForm").show();
                    }
                }
                populateSvcModal();
                $("#svc_modal").modal("show");
            }
        });

        $(document).on("click","#svc_facSearch_table tbody tr", function(){
            clearErrors();
            $("#svc_act_sel").val("").change();
            let data = svcFacSearchDatatable.row(this).data();
            if(data == undefined)
                return;
            let ftyp = $("#svc_facSearch").attr("ftyp");
            if(ftyp == 'X') {
                $("#svc_ffac_txt").val(data.fac);
                $("#svc_portX_txt").val(data.port);
                $("#svc_ftypX_txt").val(data.ftyp);
                $("#svc_ortX_txt").val(data.ort);
            }
            else if(ftyp == 'Y') {
                $("#svc_tfac_txt").val(data.fac);
                $("#svc_portY_txt").val(data.port);
                $("#svc_ftypY_txt").val(data.ftyp);
                $("#svc_ortY_txt").val(data.ort);
            }
        })
    
        $("#svc_tn_cbx").change(function(){
            $("#svc_act_sel").val("").change();
            if($("#svc_tn_cbx").is(':checked')){
                $(".svc-ckid-txt").attr("id","").hide();
                $(".svc-ckid-tn").attr("id","svc_ckid").show();
            }
            else {
                $(".svc-ckid-tn").attr("id","").hide();
                $(".svc-ckid-txt").attr("id","svc_ckid").show();
            }
        });

        $('#svc-form-date-div').on('change', function() {
            clearErrors();
            $("#svc_act_sel").val("");
        })
    
        $(document).on('input', '.svc-form', function() {
            clearErrors();
            $("#svc_act_sel").val("");
        });

        $(document).on('input', '.dataTables_filter', function() {
            clearErrors();
            $("#svc_act_sel").val("");
        });

        $("#svc_findCkid_btn").on('click', function() {
            $("#svc_act_sel").val("");
        });

        $("#svc_findOrd_btn").on('click', function() {
            $("#svc_act_sel").val("");
        });


    });
    

</script>