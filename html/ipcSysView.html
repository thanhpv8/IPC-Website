<div id="sysview" class="tab-pane fade in" style="position: relative;">
    <div class="row">
        <div align="center">
            <h4>SYSTEM VIEW</h4>
        </div>
    </div>

    <div class="sysview_node" style="display: flex; align-items: center; justify-content: center">
        
    </div>

    
    <div class="col-sm-6 row" style="padding-left: 15px">
        <div>
            <!-- X -->
            <div id="sysview_nodeX" class="sysview_nodeX col-sm-12" style="height: 30px; font-size: 0px; margin-left: 15px; float: left; width: 95%; padding-left: 0px; padding-right: 0px;"> 

            </div>
        </div>
        <div>
            <!-- X -->
            <div class="sysview_mio col-sm-12" style="border-top-left-radius: 4px; border-top-right-radius: 4px; border-right: 1px black solid; border-left: 1px black solid; height: 34px; padding-left: 0px; margin-left: 15px; padding-right: 0px; font-size: 0px; float: left; width: 95%"> 
                <button class="btn addMioStyle" style="width: 10%; font-size: 11px" id="sysview_mioX1"><div>MIOX-1</div><div id="sysview_mioX1_psta"></div></button>
                <button class="btn addMioStyle" style="width: 10%; font-size: 11px" id="sysview_mioX2"><div>MIOX-2</div><div id="sysview_mioX2_psta"></div></button>
                <button class="btn addMioStyle" style="width: 10%; font-size: 11px" id="sysview_mioX3"><div>MIOX-3</div><div id="sysview_mioX3_psta"></div></button>
                <button class="btn addMioStyle" style="width: 10%; font-size: 11px" id="sysview_mioX4"><div>MIOX-4</div><div id="sysview_mioX4_psta"></div></button>
                <button class="btn addMioStyle" style="width: 10%; font-size: 11px" id="sysview_mioX5"><div>MIOX-5</div><div id="sysview_mioX5_psta"></div></button>
                <button class="btn addMioStyle" style="width: 10%; font-size: 11px" id="sysview_mioX6"><div>MIOX-6</div><div id="sysview_mioX6_psta"></div></button>
                <button class="btn addMioStyle" style="width: 10%; font-size: 11px" id="sysview_mioX7"><div>MIOX-7</div><div id="sysview_mioX7_psta"></div></button>
                <button class="btn addMioStyle" style="width: 10%; font-size: 11px" id="sysview_mioX8"><div>MIOX-8</div><div id="sysview_mioX8_psta"></div></button>
                <button class="btn addMioStyle" style="width: 10%; font-size: 11px" id="sysview_mioX9"><div>MIOX-9</div><div id="sysview_mioX9_psta"></div></button>
                <button class="btn addMioStyle" style="width: 10%; font-size: 11px" id="sysview_mioX10"><div>MIOX-10</div><div id="sysview_mioX10_psta"></div></button>
            </div>
        </div>
        <div>
            <div>
                <!-- X -->
                <div class="col-sm-12" style="background-color: #93cbea; border-radius: 4px; padding-bottom: 25px; float: left; border: 1px black solid;">
                    <div class="row">
                        <div class="col-sm-12 sysview_part" style="display:flex;">
                            <a class="btn" id="sysview_1X" style="color: black; border-right: solid black 1px; ">1-25</a>
                            <a class="btn" id="sysview_2X" style="color: black; border-left: solid black 1px; ">26-50</a>
                        </div>
                    </div>
                    <div id="sysview_leftPort">
                        
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-sm-6 row" style="float: right; padding-right: 20px">
        <div>
            <!-- Y -->
            <div id="sysview_nodeY" class="sysview_nodeY col-sm-12" style="height: 30px; font-size: 0px; margin-left: 20px; float: left; width: 95%; padding-left: 0px; padding-right: 0px;"> 

            </div>
        </div>
        <div>
            <!-- Y -->
            <div class="sysview_mio col-sm-12" style="border-top-left-radius: 4px; border-top-right-radius: 4px; border-right: 1px black solid; border-left: 1px black solid; height: 34px; padding-left: 0px; margin-left: 20px; padding-right: 0px; font-size: 0px; float: left; width: 95%"> 
                <button class="btn addMioStyle" style="width: 10%; font-size: 11px" id="sysview_mioY1"><div>MIOY-1</div><div id="sysview_mioY1_psta"></div></button>
                <button class="btn addMioStyle" style="width: 10%; font-size: 11px" id="sysview_mioY2"><div>MIOY-2</div><div id="sysview_mioY2_psta"></div></button>
                <button class="btn addMioStyle" style="width: 10%; font-size: 11px" id="sysview_mioY3"><div>MIOY-3</div><div id="sysview_mioY3_psta"></div></button>
                <button class="btn addMioStyle" style="width: 10%; font-size: 11px" id="sysview_mioY4"><div>MIOY-4</div><div id="sysview_mioY4_psta"></div></button>
                <button class="btn addMioStyle" style="width: 10%; font-size: 11px" id="sysview_mioY5"><div>MIOY-5</div><div id="sysview_mioY5_psta"></div></button>
                <button class="btn addMioStyle" style="width: 10%; font-size: 11px" id="sysview_mioY6"><div>MIOY-6</div><div id="sysview_mioY6_psta"></div></button>
                <button class="btn addMioStyle" style="width: 10%; font-size: 11px" id="sysview_mioY7"><div>MIOY-7</div><div id="sysview_mioY7_psta"></div></button>
                <button class="btn addMioStyle" style="width: 10%; font-size: 11px" id="sysview_mioY8"><div>MIOY-8</div><div id="sysview_mioY8_psta"></div></button>
                <button class="btn addMioStyle" style="width: 10%; font-size: 11px" id="sysview_mioY9"><div>MIOY-9</div><div id="sysview_mioY9_psta"></div></button>
                <button class="btn addMioStyle" style="width: 10%; font-size: 11px" id="sysview_mioY10"><div>MIOY-10</div><div id="sysview_mioY10_psta"></div></button>
            </div>
        </div>
        <div>
            <div>
                <!-- Y -->
                <div class="col-sm-12" style="background-color: #93cbea; border-radius: 4px; padding-bottom: 25px; float: left; margin-left: 5px; border: 1px black solid;">
                    <div class="row">
                        <div class="col-sm-12 sysview_part" style="display:flex;">
                            <a class="btn" id="sysview_1Y" style="color: black; border-right: solid black 1px; ">1-25</a>
                            <a class="btn" id="sysview_2Y" style="color: black; border-left: solid black 1px; ">26-50</a>
                        </div>
                    </div>

                    <div id="sysview_rightPort">
                        
                    </div>
                </div>

            </div>
        </div>
    </div>
    <!-- <div class="row" style="padding-left: 15px">
        <div>
            <div id="sysview_nodeX" class="sysview_nodeX col-sm-6" style="font-size: 0px; width: 48%; float: left"> 

            </div>
            <div id="sysview_nodeY" class="sysview_nodeY col-sm-6" style="font-size: 0px; width: 48%; float: left; margin-left: 30px"> 

            </div>
        </div>
        <div>
            <div class="sysview_mio col-sm-6" style="border-top-left-radius: 4px; border-top-right-radius: 4px; border-top: 1px black solid; border-right: 1px black solid; border-left: 1px black solid; height: 34px; padding-left: 0px; margin-left: 15px; padding-right: 0px; font-size: 0px; width: 48%; float: left"> 
                <button class="btn addMioStyle" style="width: 10%" id="sysview_mioX1">MIOX-1</a>
                <button class="btn addMioStyle" style="width: 10%" id="sysview_mioX2">MIOX-2</a>
                <button class="btn addMioStyle" style="width: 10%" id="sysview_mioX3">MIOX-3</a>
                <button class="btn addMioStyle" style="width: 10%" id="sysview_mioX4">MIOX-4</a>
                <button class="btn addMioStyle" style="width: 10%" id="sysview_mioX5">MIOX-5</a>
                <button class="btn addMioStyle" style="width: 10%" id="sysview_mioX6">MIOX-6</a>
                <button class="btn addMioStyle" style="width: 10%" id="sysview_mioX7">MIOX-7</a>
                <button class="btn addMioStyle" style="width: 10%" id="sysview_mioX8">MIOX-8</a>
                <button class="btn addMioStyle" style="width: 10%" id="sysview_mioX9">MIOX-9</a>
                <button class="btn addMioStyle" style="width: 10%" id="sysview_mioX10">MIOX-10</a>
            </div>
            <div class="sysview_mio col-sm-6" style="border-top-left-radius: 4px; border-top-right-radius: 4px; border-top: 1px black solid; border-right: 1px black solid; border-left: 1px black solid; height: 34px; font-size: 0px; width: 48%; float: left; margin-left: 30px; padding-left: 0px; padding-right: 0px"> 
                <button class="btn addMioStyle" style="width: 10%" id="sysview_mioY1">MIOY-1</a>
                <button class="btn addMioStyle" style="width: 10%" id="sysview_mioY2">MIOY-2</a>
                <button class="btn addMioStyle" style="width: 10%" id="sysview_mioY3">MIOY-3</a>
                <button class="btn addMioStyle" style="width: 10%" id="sysview_mioY4">MIOY-4</a>
                <button class="btn addMioStyle" style="width: 10%" id="sysview_mioY5">MIOY-5</a>
                <button class="btn addMioStyle" style="width: 10%" id="sysview_mioY6">MIOY-6</a>
                <button class="btn addMioStyle" style="width: 10%" id="sysview_mioY7">MIOY-7</a>
                <button class="btn addMioStyle" style="width: 10%" id="sysview_mioY8">MIOY-8</a>
                <button class="btn addMioStyle" style="width: 10%" id="sysview_mioY9">MIOY-9</a>
                <button class="btn addMioStyle" style="width: 10%" id="sysview_mioY10">MIOY-10</a>
            </div>
        </div>

        <div id="sysview_portDisplay">

            <div>
                <div class="col-sm-6" style="background-color: #93cbea; border-radius: 4px; padding-bottom: 25px; width: 49.5%; float: left; border: 1px black solid">
                    <div class="row">
                        <div class="col-sm-6 sysview_part" style="display:flex;">
                            <a class="btn" id="sysview_1X" style="border-right: solid black 1px; ">1-25</a>
                            <a class="btn" id="sysview_2X" style="border-left: solid black 1px; ">26-50</a>
                        </div>
                    </div>
                    <div id="sysview_leftPort">
                        
                    </div>
                </div>
                <div class="col-sm-6" style="background-color: #93cbea; border-radius: 4px; padding-bottom: 25px; width: 49.5%; float: left; margin-left: 5px; border: 1px black solid">
                    <div class="row">
                        <div class="col-sm-6 sysview_part" style="display:flex;">
                            <a class="btn" id="sysview_1Y" style="border-right: solid black 1px; ">1-25</a>
                            <a class="btn" id="sysview_2Y" style="border-left: solid black 1px; ">26-50</a>
                        </div>
                    </div>

                    <div id="sysview_rightPort">
                        
                    </div>
                </div>
            </div>
        </div>
    </div> -->
</div>

<!-- ------------THIS MODEL FOR ACTION: FAC SEARCH (NODE RIGHT CLICK)----------- -->
<div id="sysviewModal_facSearch" class="modal fade" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">SYSTEM VIEW</h5>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-sm-5">
                        <label for="sysviewModal_facSearch_fac_txt">FAC: </label>
                        <input id="sysviewModal_facSearch_fac_txt" type="text" class="form-control" style="text-transform: uppercase">
                    </div>
                    <div class="col-sm-4">
                        <button id="sysviewModal_facSearch_facSearch_btn" class="btn btn-primary">VIEW</button>
                        <button class="btn btn-primary" data-dismiss="modal" aria-label="Close">Close</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ------------THIS MODEL FOR ACTION: CKID SEARCH (NODE RIGHT CLICK)----------- -->
<div id="sysviewModal_ckidSearch" class="modal fade" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">SYSTEM VIEW</h5>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-sm-4">
                        <label for="sysviewModal_ckidSearch_ckid_txt">CKID: </label>
                        <input id="sysviewModal_ckidSearch_ckid_txt" type="text" class="form-control" style="text-transform: uppercase">
                    </div>
                    <div class="col-sm-5">
                        <button id="sysviewModal_ckidSearch_ckidSearch_btn" class="btn btn-primary">VIEW</button>
                        <button class="btn btn-primary" data-dismiss="modal" aria-label="Close">CLOSE</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="sysviewMxcModal" class="modal fade" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">SYSTEM VIEW: LOCK/UNLOCK MATRIX CARD</h5>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-sm-1 modifyPadding">
                        <label for="sysviewMxcModal_node_txt">NODE</label>
                        <input class="form-control modifyPadding" type="text" id="sysviewMxcModal_node_txt" readonly>
                    </div>
                    <div class="col-sm-1 modifyPadding">
                        <label for="sysviewMxcModal_shelf_txt">SHELF</label>
                        <input class="form-control modifyPadding" type="text" id="sysviewMxcModal_shelf_txt" readonly>
                        
                    </div>
                    <div class="col-sm-1 modifyPadding">
                        <label for="sysviewMxcModal_slot_txt">SLOT</label>
                        <input class="form-control modifyPadding" type="text" id="sysviewMxcModal_slot_txt" readonly>
                    </div>
                    <div class="col-sm-2 modifyPadding">
                        <label for="sysviewMxcModal_type_txt">TYPE</label>
                        <input class="form-control modifyPadding" type="text" id="sysviewMxcModal_type_txt" readonly>
                    </div>
                    <div class="col-sm-3 modifyPadding">
                        <label for="sysviewMxcModal_stat_txt">PORT STATUS</label>
                        <input class="form-control modifyPadding" type="text" id="sysviewMxcModal_stat_txt" readonly>
                    </div>
                </div>

                <div class="row">
                    <div class="col-sm-3 modifyPadding">
                        <label for="sysviewMxcModal_act_txt">ACTION</label>
                        <input type="text" class="form-control" id="sysviewMxcModal_act_txt" readonly>
                    </div>
                    <div class="col-sm-8 modifyPadding">
                        <button class="btn btn-primary" id="sysviewMxcModal_submit_btn">Submit</button>
                        <button class="btn btn-primary" data-dismiss="modal" aria-label="Close">Close</button>
                        <br>
                    </div>
        
                </div>
                
            </div>
        </div>
    </div>
</div>

<div id="sysviewModal_viewPath" class="modal fade" role="dialog">
    <div class="modal-dialog" style="margin: 200; width: 1200px">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">SYSTEM VIEW: VIEW PATH</h5>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-sm-1">
                        <label for="sysviewModal_viewPath_node_txt">NODE: </label>
                        <input id="sysviewModal_viewPath_node_txt" type="text" class="form-control" style="text-transform: uppercase">
                    </div>
                    <div class="col-sm-1">
                        <label for="sysviewModal_viewPath_slot_txt">SLOT: </label>
                        <input id="sysviewModal_viewPath_slot_txt" type="text" class="form-control" style="text-transform: uppercase">
                    </div>
                    <div class="col-sm-1">
                        <button id="sysviewModal_viewPath_view_btn" class="btn btn-primary">VIEW</button>
                    </div>
                    <button class="btn btn-primary" data-dismiss="modal" aria-label="Close">Close</button>
                </div>
                <div class="row">
                    <div class="col-sm-12">
                        <div class="panel panel-default">
                            <table class="table table-fixed">
                                <thead style="width: 100%; padding-right: 15px">
                                    <tr>
                                        <th id="sysviewModal_viewPath_ID_tbl" style="width:5%">ID</th>
                                        <th id="sysviewModal_viewPath_STAT_tbl" style="width:5%">STAT</th>
                                        <th id="sysviewModal_viewPath_CKID_tbl" style="width:15%">CKID</th>
                                        <th id="sysviewModal_viewPath_IDX_tbl" style="width:5%">IDX</th>
                                        <th id="sysviewModal_viewPath_PORT_X_tbl" style="width:7%">PORT(X)</th>
                                        <th id="sysviewModal_viewPath_PORT_Y_tbl" style="width:8%">PORT(Y)</th>
                                        <th id="sysviewModal_viewPath_PATH_tbl" style="width:55%">PATH</th>
                                    </tr>
                                </thead>
                                <tbody id="sysviewModal_viewPath_table" style="height:300px">

                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- NODE MENU -->
<div id='sysview_nodeMenu' class="sysview_menus">
    <ul class='sysview_nodeActList'>
        <li id='sysview_act_viewAlm'>VIEW_ALARM</li>
        <li id='sysview_act_lockNode'>LOCK_NODE</li>
        <li id='sysview_act_unlockNode'>UN-LOCK_NODE</li>
        <li id='sysview_act_discover'>DISCOVER_NODE</li>
        <li id='sysview_act_startNode'>START_NODE</li>
        <li id='sysview_act_stopNode'>STOP_NODE</li>
        <li id='sysview_act_findFac'>FIND FAC</li>
        <li id='sysview_act_findCkid'>FIND CKID</li>
        <li id='sysview_act_viewCmd'>VIEW CMD</li>
    </ul>
</div>

<!-- MIO MENU -->
<div id='sysview_mioMenu' class="sysview_menus">
    <ul class='sysview_mioActList'>
        <li id='sysview_act_refresh'>REFRESH</li>
        <li id='sysview_act_lockCard'>LOCK CARD</li>
        <li id='sysview_act_unlockCard'>UNLOCK CARD</li>
        <li id='sysview_act_viewPath'>VIEW PATH</li>
    </ul>
</div>

<!-- Port menu -->
<div id='sysview_portMenu'>
    <ul id='sysview_portAct' class='sysview_actList'>
        <li id='sysview_act_viewCkid'>VIEW_CKID</li>
        <li id='sysview_act_map'>MAP</li>
        <li id='sysview_act_unMap'>UNMAP</li>
        <li id='sysview_act_setDefected'>SET_DEFECTED</li>  
        <li id='sysview_act_setReserved'>SET_RESERVED</li>
        <li id='sysview_act_setSF'>SET_SF</li>
      <!-- <li id='sysview_act_group'>
          <div>MTC</div>
          <ul> -->
            <li id='sysview_act_discMtc'>MTC_DISCON</li>
            <li id='sysview_act_conMtc'>MTC_CONN</li>
            <li id='sysview_act_restoreMtc'>MTC_RESTORE</li>
            <li id='sysview_act_restoreMtcd'>RESTORE_MTCD</li>
            <li id='sysview_act_testMtc'>MTC_TEST</li>
          <!-- </ul>
      </li> -->
     
    </ul>
</div>


<!-- MODAL FOR DISPLAY CKID, SET_RESERVED, SET_DEFECTED -->
<div id="sysviewModal" class="modal fade" role="dialog">
    <div class="modal-dialog" style="margin: 200; width: 1200px">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">SYSTEM VIEW</h5>
            </div>
            <div class="modal-body">
                <div id="sysviewModal_showConn">
                    <div class="row">
                        <div class="col-sm-3">
                            <label for="sysviewModal_ckid_txt">CKID: </label>
                            <input id="sysviewModal_ckid_txt" style="text-transform: uppercase" type="text" class="form-control">
                        </div>
                        <div class="col-sm-2">
                            <label for="sysviewModal_cls_txt">CLS: </label>
                            <input id="sysviewModal_cls_txt" type="text" class="form-control" style="text-transform: uppercase">
                        </div>
                        <div class="col-sm-2">
                            <label for="sysviewModal_adsr_txt">ADSR: </label>
                            <input id="sysviewModal_adsr_txt" type="text" class="form-control" style="text-transform: uppercase">
                        </div>
                        <div class="col-sm-2">
                            <label for="sysviewModal_prot_txt">PROT: </label>
                            <input id="sysviewModal_prot_txt" type="text" class="form-control" style="text-transform: uppercase">
                        </div>
                        <div class="col-sm-3">
                            <button class="btn btn-primary" data-dismiss="modal" aria-label="Close">Close</button>
                        </div>
                    </div>
                    <div class="row" hidden>
                        <div class="col-sm-3">
                            <label>STATUS</label>
                        </div>
                        <div class="col-sm-3">
                            <label>PORT</label>
                        </div>
                        <div class="col-sm-3">
                            <label>FAC</label>
                        </div>
                        <div class="col-sm-3">
                            <label>FAC_TYP</label>
                        </div>
                    </div>
                    <div id="sysviewModal_connections" hidden>

                    </div>
                    <div class="row">
                        <div class="col-sm-12">
                            <label>LIST OF CONNECTIONS:</label>
                        </div>
                        <div class="col-sm-12">
                            <div class="panel panel-default">
                                <table class="table table-fixed">
                                    <thead style="width:100%; padding-right: 15px">
                                        <tr>
                                            <th style="width:15%"></th>
                                            <th style="width:42%">FROM (X):</th>
                                            <th style="width:43%">TO (Y):</th>
                                        </tr>
                                        <tr>
                                            <th style="width:5%">ID</th>
                                            <th style="width:10%">CONTYP</th>
                                            <th style="width:10%">PORT</th>
                                            <th style="width:10%">PSTA</th>
                                            <th style="width:22%">FAC(X)</th>
                                            <th style="width:10%">PORT</th>
                                            <th style="width:10%">PSTA</th>
                                            <th style="width:23%">FAC(Y)</th>
                                        </tr>
                                    </thead>
                                    <tbody id="sysviewModal_ckidSearch_tbl" style="height:200px;">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="sysviewModal_showMap">
                    <div class="row">
                        <div class="col-sm-3 modifyPadding">
                            <label for="sysviewModal_port_txt">PORT</label>
                            <input type="text" class="form-control" id="sysviewModal_port_txt" readonly>
                        </div>

                        <div class="col-sm-3 modifyPadding">
                            <label for="sysviewModal_ptyp_txt">PORT_TYP</label>
                            <input type="text" class="form-control" id="sysviewModal_ptyp_txt" readonly>
                        </div>
                            
                        <div class="col-sm-3 modifyPadding">
                            <label for="sysviewModal_psta_txt">PSTA</label>
                            <input type="text" class="form-control" id="sysviewModal_psta_txt" readonly>
                        </div>
                    </div>
                    <div class='row'>
                        <!-- ------------------------------------------------ -->
                        <div class="col-sm-3 modifyPadding" > 
                            <label for="sysviewModal_act_txt">ACTION</label>    
                            <input type="text" class="form-control" id="sysviewModal_act_txt" readonly>
                        </div> 
                        <div class="col-sm-6 modifyPadding">
                            <button id="sysviewModal_submit_btn" type="button" class="btn btn-primary">Submit</button>
                            <button class="btn btn-primary" data-dismiss="modal" aria-label="Close">Close</button>
                        </div>
                
                    </div>
                </div>
              
            </div>
        </div>
    </div>
</div>

<!-- MODAL FOR NODES -->
<div id="sysviewNodeModal" class="modal fade" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Node Administration</h5>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-sm-1 modifyPadding">
                        <label for="sysviewNodeModal_nodeId_num">NODE</label>
                        <input id="sysviewNodeModal_nodeId_num" type="number" class="form-control">
                    </div>
                    <div class="col-sm-3 modifyPadding">
                        <label for="sysviewNodeModal_status_txt">CURRENT_STATUS</label>
                        <input id="sysviewNodeModal_status_txt" type="text" class="form-control">
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-3 modifyPadding">
                        <label for="sysviewNodeModal_act_txt">ACTION</label>
                        <input type="text" class="form-control" id="sysviewNodeModal_act_txt" readonly>
                    </div>

                    <div class="col-sm-8 modifyPadding">
                        <button id="sysviewNodeModal_submit_btn" type="button" class="btn btn-primary">Submit</button>
                        <button class="btn btn-primary" data-dismiss="modal" aria-label="Close">Close</button>
                    </div>

                </div>

            </div>
        </div>
    </div>
</div>

<!-- MODAL FOR CMD -->
<div id="sysviewCmdModal" class="modal fade" rode="dialog">
    <div class="modal-dialog" style="margin: 200; width: 1200px">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">SYSTEM VIEW: VIEW CMD</h5>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-sm-2">
                        <label for="sysviewCmdModal_ackid_txt">ACKID</label>
                        <input id="sysviewCmdModal_ackid_txt" type="text" class="form-control" readonly>
                    </div>
                    <div class="col-sm-10">
                        <label for="sysviewCmdModal_cmd_txt">CMD</label>
                        <input id="sysviewCmdModal_cmd_txt" type="text" class="form-control" readonly>
                    </div>
                    <div hidden>
                        <input id="sysviewCmdModal_stat_txt">
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-2">
                        <button id="sysviewCmdModal_submit_btn" type="button" class="btn btn-primary">Submit</button>
                        <button class="btn btn-primary" data-dismiss="modal" aria-label="Close">Close</button>
                    </div>
                </div>
                <br>
                <div class="row">
                    <div class="col-sm-12">
                        <label>LIST OF CMDS:</label>
                    </div>
                    <br>
                    <div class="col-sm-12">
                        <div class="panel panel-default">
                            <table class="table table-fixed">
                                <thead style="width: 100%; padding-right: 15px">
                                    <tr>
                                        <th style="width: 10%">ACKID</th>
                                        <th style="width: 80%">CMD</th>
                                        <th style="width: 10%">STAT</th>
                                    </tr>
                                </thead>
                                <tbody id="sysviewCmdModal_tbl">

                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
    
    
<script>

var sysview = {
    nodeList:        $(".sysview_node"),
    nodesArray:      [],
    nodes:           0,
    nodesNum:        0,
    nodeX:           $("#sysview_nodeX"),
    nodeY:           $("#sysview_nodeY"),

    nodeXActive:     1,
    nodeYActive:     1,
    nodeXActiveId:   "",
    nodeYActiveId:   "",

    nodeASD: "",

    node_info: [],

    nodeXId:         [],
    nodeYId:         [],
    mioX1:           $("#sysview_mioX1"),
    mioX2:           $("#sysview_mioX2"),
    mioX3:           $("#sysview_mioX3"),
    mioX4:           $("#sysview_mioX4"),
    mioX5:           $("#sysview_mioX5"),
    mioX6:           $("#sysview_mioX6"),
    mioX7:           $("#sysview_mioX7"),
    mioX8:           $("#sysview_mioX8"),
    mioX9:           $("#sysview_mioX9"),
    mioX10:          $("#sysview_mioX10"),

    mioY1:           $("#sysview_mioY1"),
    mioY2:           $("#sysview_mioY2"),
    mioY3:           $("#sysview_mioY3"),
    mioY4:           $("#sysview_mioY4"),
    mioY5:           $("#sysview_mioY5"),
    mioY6:           $("#sysview_mioY6"),
    mioY7:           $("#sysview_mioY7"),
    mioY8:           $("#sysview_mioY8"),
    mioY9:           $("#sysview_mioY9"),
    mioY10:          $("#sysview_mioY10"),

    mioXPsta: [
        $("#sysview_mioX1_psta"),
        $("#sysview_mioX2_psta"),
        $("#sysview_mioX3_psta"),
        $("#sysview_mioX4_psta"),
        $("#sysview_mioX5_psta"),
        $("#sysview_mioX6_psta"),
        $("#sysview_mioX7_psta"),
        $("#sysview_mioX8_psta"),
        $("#sysview_mioX9_psta"),
        $("#sysview_mioX10_psta"),
    ],

    mioYPsta: [
        $("#sysview_mioY1_psta"),
        $("#sysview_mioY2_psta"),
        $("#sysview_mioY3_psta"),
        $("#sysview_mioY4_psta"),
        $("#sysview_mioY5_psta"),
        $("#sysview_mioY6_psta"),
        $("#sysview_mioY7_psta"),
        $("#sysview_mioY8_psta"),
        $("#sysview_mioY9_psta"),
        $("#sysview_mioY10_psta"),
    ],

    mioX1Psta:           $("#sysview_mioX1_psta"),
    mioX2Psta:           $("#sysview_mioX2_psta"),
    mioX3Psta:           $("#sysview_mioX3_psta"),
    mioX4Psta:           $("#sysview_mioX4_psta"),
    mioX5Psta:           $("#sysview_mioX5_psta"),
    mioX6Psta:           $("#sysview_mioX6_psta"),
    mioX7Psta:           $("#sysview_mioX7_psta"),
    mioX8Psta:           $("#sysview_mioX8_psta"),
    mioX9Psta:           $("#sysview_mioX9_psta"),
    mioX10Psta:          $("#sysview_mioX10_psta"),

    mioY1Psta:           $("#sysview_mioY1_psta"),
    mioY2Psta:           $("#sysview_mioY2_psta"),
    mioY3Psta:           $("#sysview_mioY3_psta"),
    mioY4Psta:           $("#sysview_mioY4_psta"),
    mioY5Psta:           $("#sysview_mioY5_psta"),
    mioY6Psta:           $("#sysview_mioY6_psta"),
    mioY7Psta:           $("#sysview_mioY7_psta"),
    mioY8Psta:           $("#sysview_mioY8_psta"),
    mioY9Psta:           $("#sysview_mioY9_psta"),
    mioY10Psta:          $("#sysview_mioY10_psta"),


    x:              $("#sysview_x"),
    y:              $("#sysview_y"),
    portDisplay:    $("#sysview_portDisplay"),
    leftPort:       $("#sysview_leftPort"),
    rightPort:      $("#sysview_rightPort"),


    selectedPortX:  [],
    selectedPortY:  [],

    selectedMioXOldPsta:    1,
    selectedMioYOldPsta:    1,
    selectedPartX:          1,
    selectedPartY:          1,

    xy:             0,
    ptyp:           0,
    node:           [],
    mio:            [],
    portX:          [],
    portY:          [],
    ckidRows:       [],
    part:           1,
    partXNum:       1,
    partYNum:       1,

    part1X:         $("#sysview_1X"),
    part2X:         $("#sysview_2X"),
    part1Y:         $("#sysview_1Y"),
    part2Y:         $("#sysview_2Y"),

    facRows:        [],
    facNode:        "",
    facSlot:        "",
    facType:        "",
    facPort:        "",
    mioXIndex:      1,
    mioYIndex:      1,

    nodeIndex:      1,
    firstLoad:      true,
    portPicked:     [],

    //----------------Port menu----------------------
    portPicked:     [],
    portMenu:       $("#sysview_portMenu"),
    actList:        $(".sysview_actList"),
    actViewCkid:    $("#sysview_act_viewCkid"),
    actMap:         $("#sysview_act_map"),
    actUnmap:       $("#sysview_act_unMap"),
    actDefected:    $("#sysview_act_setDefected"),
    actReserved:    $("#sysview_act_setReserved"),   
    actSF:          $("#sysview_act_setSF"),  
    actDiscMtc:     $("#sysview_act_discMtc"),
    actConMtc:      $("#sysview_act_conMtc"),
    actRestoreMtc:  $("#sysview_act_restoreMtc"),
    actRestoreMtcd: $("#sysview_act_restoreMtcd"),
    actTestMtc:     $("#sysview_act_testMtc"),
    connPicked:     [],
    portAct:        null,
    
    //-------------Node Menu----------------------
    nodeMenu:       $("#sysview_nodeMenu"),

    //add actions in the list below here as members
    actViewAlm:     $("#sysview_act_viewAlm"),
    actUnlockNode:  $("#sysview_act_unlockNode"),
    actLockNode:    $("#sysview_act_lockNode"),
    actDiscover:    $("#sysview_act_discover"),
    actStartNode:   $("#sysview_act_startNode"),
    actStopNode:    $("#sysview_act_stopNode"),
    actFindFac:     $("#sysview_act_findFac"),
    actFindCkid:    $("#sysview_act_findCkid"),
    actViewCmd:     $("#sysview_act_viewCmd"),
    nodePicked:     [],
    nodeStatPicked: [],
    nodesArray:     [],

    //----------------Mio Menu-----------------
    mioMenu:        $("#sysview_mioMenu"),
    highlightedMio: "",
    highlightedMioPtyp: "",
    highlightedMioShelf: "",
    activeMioX:      "",
    activeMioY:      "",
    mioStatPicked: [],

    //add actions in the list below here as members
    actRefresh:     $("#sysview_act_refresh"),
    actLockCard:    $("#sysview_act_lockCard"),
    actUnlockCard:  $("#sysview_act_unlockCard"),
    actViewPath:    $("#sysview_act_viewPath"),

    start: function() {
        
        // run the first load of the tab
        if (sysview.firstLoad && wc.nodes > 0) {
            var a = [];
            var b = [];
            var c = [];
            sysview.nodeXId = [];
            sysview.nodeYId = [];

            for (var i = 0; i < wc.nodes; i++) {

                var n = i + 1;

                // creates btns
                b.push('<button class="btn addNodeBorder" style="width: 10%" id="sysview_nodeX' + n + '">NODE-' + n + '</button>')
                
                // creates btns
                c.push('<button class="btn addNodeBorder" style="width: 10%" id="sysview_nodeY' + n + '">NODE-' + n + '</button>')
                                
            }

            for (var i = 0; i < wc.nodes; i++) {
                var n = i+1;         
                a.push('<button style="border-radius: 4px" class="addNodeStyle"id="sysview_n' + n + '_btn">a</button>');
            }
            sysview.nodeList.html(a.join(""));

            for (var i = 0; i < wc.nodes; i++) {
                var n = i + 1;
                // Creates Big node buttons

                $('#sysview_n' + n + '_btn').html("<small class='node-header'>Node " 
                    + n + "<br>" + sysview.node_info[i].node_stat 
                    + "<br>" + "Alm: " + sysview.node_info[i].node_alm 
                    + "</small> <div><div class='col-sm-6 node-temp-volt'>" 
                        + sysview.node_info[i].node_temp + "  |  " 
                        + sysview.node_info[i].node_volt + "</div><div class='col-sm-6 node-rack'> LOC: " 
                            + sysview.node_info[i].node_rack + "</div></div>");

                if (sysview.node_info[i].node_alm == "MAJ") {
                    $("#sysview_n" + n + '_btn').addClass('nodeMajor');
                }
                else if (sysview.node_info[i].node_alm == "MIN") {
                    $("#sysview_n" + n + '_btn').addClass("nodeMinor");
                }
                else if (sysview.node_info[i].node_alm == "CRI") {
                    $("#sysview_n" + n + '_btn').addClass("nodeCritical");
                }
                else if (sysview.node_info[i].node_alm == "NONE") {
                    $("#sysview_n" + n + '_btn').addClass("nodeNone");
                }
            }


            sysview.nodeIndex = 1;
            sysview.nodeXActive = 1;
            sysview.nodeYActive = 1;
            sysview.firstLoad = false;
            sysview.nodeX.html(b.join(""));
            sysview.nodeY.html(c.join(""));
            sysview.nodeXId.push(sysview.nodeX.children());
            sysview.nodeYId.push(sysview.nodeY.children());
    
            sysview.nodeXActiveId = sysview.nodeXId[0].attr('id');
            sysview.nodeYActiveId = sysview.nodeYId[0].attr('id');
    
            $("#sysview_nodeX1").addClass("addBGColor");
            $("#sysview_nodeX1").addClass("addNodeBorder");
            $("#sysview_nodeX1").siblings().addClass("addNodeBorder");
            $("#sysview_nodeX1").siblings().removeClass("addBGColor");
            $("#sysview_nodeY1").addClass("addBGColor");
            $("#sysview_nodeY1").addClass("addNodeBorder");
            $("#sysview_nodeY1").siblings().addClass("addNodeBorder");
            $("#sysview_nodeY1").siblings().removeClass("addBGColor");
            sysview.mioXIndex = 1;
            sysview.mioYIndex = 1;
            sysview.mioX1.addClass("addBGColor");
            sysview.mioX1.addClass("activeMioStyle");
            sysview.mioX1.siblings().removeClass("addBGColor");
            sysview.mioX1.siblings().removeClass("activeMioStyle");
            sysview.activeMioX = sysview.mioX1.attr('id');
            sysview.mioY1.addClass("addBGColor");
            sysview.mioY1.addClass("activeMioStyle");
            sysview.mioY1.siblings().removeClass("addBGColor");
            sysview.mioY1.siblings().removeClass("activeMioStyle");
            sysview.activeMioY = sysview.mioY1.attr('id');
            sysview.xy = 'x';
            sysview.part1X.addClass("addBorder");
            sysview.part1X.siblings().removeClass("addBorder");
            sysview.part1Y.addClass("addBorder");
            sysview.part1Y.siblings().removeClass("addBorder");
            sysview.queryX(sysview.partXNum);
            sysview.queryY(sysview.partYNum);
    
            sysview.bindNodeMenu();
            sysview.bindMioMenu();
            sysview.hoverEvent.node();
            sysview.hoverEvent.mio();
        }
        
    },

    updateNode: function() {
        if (sysview.firstLoad) {
            return;
        } else {
            sysview.node_info.forEach(function(node) {
                let node_header = 'Node ' + node.node + '<br>' + node.node_stat + '<br>Alm: ' + node.node_alm;
                let node_temp_volt = node.node_temp + '  |  ' + node.node_volt;
                let node_rack = 'LOC: ' + node.node_rack;

                $('#sysview_n' + node.node + '_btn .node-header').html(node_header);
                $('#sysview_n' + node.node + '_btn .node-temp-volt').text(node_temp_volt);
                $('#sysview_n' + node.node + '_btn .node-rack').text(node_rack);

                if (node.node_alm == "MAJ") {
                    $("#sysview_n" + node.node + '_btn').attr('class', 'addNodeStyle nodeMajor')
                }
                else if (node.node_alm == "MIN") {
                    $("#sysview_n" + node.node + '_btn').attr('class', "addNodeStyle nodeMinor");
                }
                else if (node.node_alm == "CRI") {
                    $("#sysview_n" + node.node + '_btn').attr('class', "addNodeStyle nodeCritical");
                }
                else if (node.node_alm == "NONE") {
                    $("#sysview_n" + node.node + '_btn').attr('class', "addNodeStyle nodeNone");
                }


                sysview.updateMio(node.node, node.MIOX, node.MIOY);
            });

        }
    },

    updateMio: function(node, mioX, mioY) {
        n = String(node);

        sysview.selectedMioXOldPsta = $("#" + sysview.activeMioX + "_psta").text();
        sysview.selectedMioYOldPsta = $("#" + sysview.activeMioY + "_psta").text();
        sysview.selectedPartX = String(sysview.partXNum);
        sysview.selectedPartY = String(sysview.partYNum);

        for (i = 0; i < mioX.length; i++) {
            if (sysview.nodeXActive == node) {
                $("#sysview_mioX" + (i + 1) + "_psta").text(mioX[i]);
            }
        }
        for (i = 0; i < sysview.mioYPsta.length; i++) {
            if (sysview.nodeYActive == node) {
                $("#sysview_mioY" + (i + 1) + "_psta").text(mioY[i]);
            }
        }

        if ($("#main_currentUser").text() == "") {
            return;
        }
        
        if (sysview.selectedMioXOldPsta != sysview.node_info[sysview.nodeXActive - 1].MIOX[sysview.mioXIndex - 1]) {
            sysview.queryX(sysview.partXNum);
        }
        if (sysview.selectedMioYOldPsta != sysview.node_info[sysview.nodeYActive - 1].MIOY[sysview.mioYIndex - 1]) {
            sysview.queryY(sysview.partYNum);
        }
        
    },

    queryX: function(part) {
    
        $.post(ipcDispatch,
        {
            api:    "ipcPortmap",
            act:	"QUERYMIO",
            user:   "SYSTEM",
            node:	sysview.nodeXActive,
            slot:	sysview.mioXIndex,
            ptyp:	"x",
        },
        function (data, status) {
            var obj = JSON.parse(data);
            if (obj.rslt  ==  "fail") {
                alert(obj.reason);
            }
            else {
            
                sysview.leftPort.empty();
            
                sysview.portX = obj.rows;
                sysview.createPortX(part); 
                sysview.bindPortMenu();
               
            }
        });
    },

    queryY: function(part) {
    
        $.post(ipcDispatch,
        {
            api:    "ipcPortmap",
            act:	"QUERYMIO",
            user:   "SYSTEM",
            node:	sysview.nodeYActive,
            slot:	sysview.mioYIndex,
            ptyp:	"y",
        },
        function (data, status) {
            var obj = JSON.parse(data);
            if (obj.rslt  ==  "fail") {
                alert(obj.reason);
            }
            else {
            
                sysview.rightPort.empty();
            
                sysview.portY = obj.rows;
                sysview.createPortY(part);
                /// create click-event and bind menu to X and Y port
                // sysview.createClickEvent();
                sysview.bindPortMenu()
            }
        });
    },

    query: function(fac, part, node, slot, ptyp) {
    
        $.post(ipcDispatch,
        {
            api:    "ipcPortmap",
            act:	"QUERYMIO",
            user:	$("#main_currentUser").text(),
            node:	node,
            slot:	slot,
            ptyp:	ptyp,
        },
        function (data, status) {
            var obj = JSON.parse(data);
            if (obj.rslt  ==  "fail") {
                alert(obj.reason);
            }
            else {
            
                if (ptyp == "X") {
                    sysview.leftPort.empty();
                    sysview.portX = obj.rows;
                    sysview.createPortX(part);
                }
                else if (ptyp == "Y") {
                    sysview.rightPort.empty();
                    sysview.portY = obj.rows;
                    sysview.createPortY(part);
                }

                /// create click-event and bind menu to X and Y port
                // sysview.createClickEvent();
                sysview.bindPortMenu()


                // Handle highlight of the icon with the chosen FAC
                // var fac = document.getElementsByClassName(fac);
                var icon = $("." + fac).parent();
            
                // if (ptyp == "X") {
                //     console.log("ptyp:" + ptyp);
                //     sysview.selectedPortX = icon;
                //     sysview.selectedPortX.addClass("addBorder");
                //     sysview.selectedPortX.siblings().removeClass("addBorder");
                // }
                // else if (ptyp == "Y") {
                //     console.log("ptyp:" + ptyp);
                //     sysview.selectedPortY = icon;
                //     sysview.selectedPortY.addClass("addBorder");
                //     sysview.selectedPortY.siblings().removeClass("addBorder");
                // }
                icon.addClass("addBorder");
                icon.siblings().removeClass("addBorder");

                // Handle highlight of the appropriate NODE
                sysview.nodeIndex = sysview.facNode;
            
                if (ptyp == "X") {
                    $("#sysview_nodeX" + sysview.facNode).addClass("addBGColor");
                    $("#sysview_nodeX" + sysview.facNode).siblings().removeClass("addBGColor");

                }
                else if (ptyp == "Y") {
                    $("#sysview_nodeY" + sysview.facNode).addClass("addBGColor");
                    $("#sysview_nodeY" + sysview.facNode).siblings().removeClass("addBGColor");

                }

                // $("#sysview_n" + sysview.facNode + "_btn").addClass("addBorder");
                // $("#sysview_n" + sysview.facNode + "_btn").siblings().removeClass("addBorder");

                // Handle highlight of the appropriate MIO
                if (ptyp == "X") {
                    sysview.mioXIndex = sysview.facSlot;
                    $("#sysview_mioX" + sysview.facSlot).addClass("addBGColor");
                    $("#sysview_mioX" + sysview.facSlot).siblings().removeClass("addBGColor");
                    
                    // Handle highlight of the buttons 1-25 | 26-50
                    if (part == 1) {
                        sysview.part1X.addClass("addBGColor");
                        sysview.part1X.siblings().removeClass("addBGColor");
                    }
                    else if (part == 2) {
                        sysview.part2X.addClass("addBGColor");
                        sysview.part2X.siblings().removeClass("addBGColor");
                    }
                }
                else if (ptyp == "Y") {
                    sysview.mioYIndex = sysview.facSlot;
                    $("#sysview_mioY" + sysview.facSlot).addClass("addBGColor");
                    $("#sysview_mioY" + sysview.facSlot).siblings().removeClass("addBGColor"); 

                    // Handle highlight of the buttons 1-25 | 26-50
                    if (part == 1) {
                        sysview.part1Y.addClass("addBGColor");
                        sysview.part1Y.siblings().removeClass("addBGColor");
                    }
                    else if (part == 2) {
                        sysview.part2Y.addClass("addBGColor");
                        sysview.part2Y.siblings().removeClass("addBGColor");
                    }

                }
                


            }
        });
    },

    queryConnByCkid: function(ckid, type) {
        $.post(ipcDispatch,
        {
            api:    "ipcProv",
            act:	"queryCktconByCkid",
            user:	$("#main_currentUser").text(),
            ckid:   ckid,
        },
        function (data, status) {
            var obj = JSON.parse(data);
            if (obj.rslt  ==  "fail") {
                alert(obj.reason);
            }
            else {
                if (obj.rows.length == 0) {
                    alert('No connection information')
                    return;
                }
                sysview.ckidRows = obj.rows;
                if (type == 'CKID') {
                    sysview.ckidRows = obj.rows;
                    sysviewModal.modal.modal();
                    sysviewModal.startShowConn();
                }
                else if (type == 'MTC_DISCON') {
                    var idx = sysview.portPicked.con_idx;
                
                    var connId = sysview.ckidRows.findIndex(x => x.idx === idx);

                    sysview.connPicked = sysview.ckidRows[connId];

                    maintModal.clearForm();
                    sysview.populateMtcForm();
                    maintModal.disableForm();
                    maintModal.act.prop("disabled",true);
                    maintModal.reConForm.hide();
                    maintModal.newConForm.hide();
                    maintModal.changeConForm.hide();
                    maintModal.clearBtn.hide();
                    maintModal.testPortForm.hide();
                    maintModal.discConForm.show();

                    maintModal.modal.modal();
                }

                else if (type == 'MTC_CONN') {
                    var idx = sysview.portPicked.con_idx;
                
                    var connId = sysview.ckidRows.findIndex(x => x.idx === idx);

                    sysview.connPicked = sysview.ckidRows[connId];

                    maintModal.clearForm();
                    sysview.populateMtcForm();
                    
                    maintModal.loadFacX();
                    maintModal.loadFacY();
                    // maintModal.disableForm();
                    if(sysview.portPicked.fac == maintModal.conFacX.val()) {
                        maintModal.pick1.prop('checked',true);
                        maintModal.pick2.prop('checked',false);
                        maintModal.conTfac.prop("disabled", false);
                        maintModal.conFfac.prop("disabled", true);
                    }
                    if(sysview.portPicked.fac == maintModal.conFacY.val()) {
                        maintModal.pick1.prop('checked',false);
                        maintModal.pick2.prop('checked',true);
                        maintModal.conTfac.prop("disabled", true);
                        maintModal.conFfac.prop("disabled", false);
                    }

                    maintModal.pick1.prop('disabled',true);
                    maintModal.pick2.prop('disabled',true);



                    maintModal.newConForm.show();
                    maintModal.reConForm.hide();
                    maintModal.discConForm.hide();
                    maintModal.changeConForm.hide();
                    maintModal.testPortForm.hide();
                    maintModal.clearBtn.hide();
                    maintModal.modal.modal();
                }
                else if(type == 'MTC_RESTORE') {
                    var idx = sysview.portPicked.con_idx;
                
                    var connId = sysview.ckidRows.findIndex(x => x.idx === idx);

                    sysview.connPicked = sysview.ckidRows[connId];

                    maintModal.clearForm();
                    sysview.populateMtcForm();
                    
                    maintModal.reConForm.show();
                    maintModal.newConForm.hide();
                    maintModal.discConForm.hide();
                    maintModal.changeConForm.hide();
                    maintModal.testPortForm.hide();
                    
                    maintModal.clearBtn.hide();
                    maintModal.modal.modal();
                }
                else if(type == 'RESTORE_MTCD') {
                    var idx = sysview.portPicked.con_idx;
                
                    var connId = sysview.ckidRows.findIndex(x => x.idx === idx);

                    sysview.connPicked = sysview.ckidRows[connId];
                    maintModal.clearForm();
                    sysview.populateMtcForm();
                    maintModal.reConForm.show();
                    maintModal.discConForm.hide();
                    maintModal.changeConForm.hide();
                    maintModal.newConForm.hide();
                    maintModal.testPortForm.hide();

                    maintModal.clearBtn.hide();
                    maintModal.modal.modal();
                }
                else if(type == 'MTC_TEST') {
                    
                }
            
            }
        });

    },

    createPortX: function(part) {
        if (part == 1) {
            var startIndex = 0;
            var endIndex = 25;
        }
        else if (part == 2) {
            var startIndex = 25;
            var endIndex = 50;
        }
        var a =[];
        for (var i = startIndex; i < endIndex; i++) {
            var port = sysview.portX[i].node + '-' + sysview.portX[i].slot + '-' + sysview.portX[i].ptyp + '-' + sysview.portX[i].pnum;

            a.push('<button style="border-radius: 4px" type="button" id="sysview_x' + sysview.portX[i].id + '">&nbsp;<div style="float:left">&nbsp;' + port + '</div><div style="float:right">' + sysview.portX[i].psta + '&nbsp;</div><br><div class="' + sysview.portX[i].fac + '" style="float:left; overflow: hidden; text-overflow: ellipsis; width: 65%; text-align: left">&nbsp;' + sysview.portX[i].fac + '</div><div style="float:right">' + sysview.portX[i].ftyp + '&nbsp;</div><br><div>&nbsp;' + sysview.portX[i].ckid + '</div></button>')
            $(document).on("click","#sysview_" + sysview.xy + sysview.portX[i].id,function(){
                
            })
        }
    
        sysview.leftPort.html(a.join(""));
        
    
        // a = [];
        // for (var i = sysview.port.length/2; i < sysview.port.length; i++) {
        //     var port = sysview.port[i].node + '-' + sysview.port[i].slot + '-' + sysview.port[i].ptyp + '-' + sysview.port[i].pnum;

        //     a.push('<button type="button" id="sysview_' + sysview.xy + sysview.port[i].id + '">&nbsp<div style="float:left">' + port + '</div><div style="float:right">' + sysview.port[i].psta + '</div><br>&nbsp' + sysview.port[i].fac + '<br>&nbsp' + sysview.port[i].ckid + '</button>')
        //     $(document).on("click","#sysview_" + sysview.xy + sysview.port[i].id,function() {
                
        //     })
        // }
        // sysview.rightPort.html(a.join(""));
    
    
        for (var i = 0; i <sysview.portX.length; i++) { 

            $("#sysview_x" + sysview.portX[i].id).addClass("addPortStyle");
            $("#sysview_x" + sysview.portX[i].id).addClass("addPortFontStyle");
            if (sysview.portX[i].psta == "CONN") {
                $("#sysview_x" + sysview.portX[i].id).css("background-color","#7BC63E")
            }
            else if (sysview.portX[i].psta == "SF") {
                $("#sysview_x" + sysview.portX[i].id).css("background-color","#F75A00")
            }

        }


        // sysview.createClickEvent("x");
    },

    createPortY: function(part) {

        if (part == 1) {
            var startIndex = 0;
            var endIndex = 25;
        }
        else if (part == 2) {
            var startIndex = 25;
            var endIndex = 50;
        }

        // Creates port icons on Y side
        var a =[];
        for (var i = startIndex; i < endIndex; i++) {
            var port = sysview.portY[i].node + '-' + sysview.portY[i].slot + '-' + sysview.portY[i].ptyp + '-' + sysview.portY[i].pnum;

            a.push('<button style="border-radius: 4px" type="button" id="sysview_y' + sysview.portY[i].id + '">&nbsp;<div style="float:left">&nbsp;' + port + '</div><div style="float:right">' + sysview.portY[i].psta + '&nbsp;</div><br><div class="' + sysview.portY[i].fac + '" style="float:left; overflow: hidden; text-overflow: ellipsis; width: 65%; text-align: left">&nbsp;' + sysview.portY[i].fac + '</div><div style="float:right">' + sysview.portY[i].ftyp + '&nbsp;</div><br><div>&nbsp;' + sysview.portY[i].ckid + '</div></button>')
            $(document).on("click","#sysview_" + sysview.xy + sysview.portY[i].id,function(){
                
            })
        }
    
        sysview.rightPort.html(a.join(""));
    

        for (var i = 0; i < sysview.portY.length; i++) { 

            $("#sysview_y" + sysview.portY[i].id).addClass("addPortStyle");
            $("#sysview_y" + sysview.portY[i].id).addClass("addPortFontStyle");
            if (sysview.portY[i].psta == "CONN") {
                $("#sysview_y" + sysview.portY[i].id).css("background-color","#7BC63E")
            }
            else if (sysview.portY[i].psta == "SF") {
                $("#sysview_y" + sysview.portY[i].id).css("background-color","#F75A00")
            }

        }


        // sysview.createClickEvent("y");
    },

    // createClickEvent: function(part) {
    //     if (part == "x") {
    //         for (var i = 0; i < sysview.portX.length; i++) {
    //             $("#sysview_x" + sysview.portX[i].id).on('click', function() {
    //                 var portId = this.id.slice(this.id.indexOf("_") + 2);
    //                 var id = sysview.portX.findIndex(x => x.id === portId);
    //                 // var convertedId = id - ((sysview.mioIndex * 50) - 50);
    //                 if (sysview.portX[id].ckid !== "") {
    //                     sysview.queryByCkid(sysview.portX[id].ckid);
    //                 }
    //             });
    //         }
    //     }
    //     else if (part == "y") {
    //         for (var i = 0; i < sysview.portY.length; i++) {
    //             $("#sysview_y" + sysview.portY[i].id).on('click', function() {
    //                 var portId = this.id.slice(this.id.indexOf("_") + 2);
    //                 var id = sysview.portY.findIndex(y => y.id === portId);
    //                 // var convertedId = id - (500 + (sysview.mioIndex * 50) - 50);
    //                 // var id = i;
    //                 if (sysview.portY[id].ckid !== "") {
    //                     sysview.queryByCkid(sysview.portY[id].ckid);
    //                 }
    //             });
    //         }
    //     }
    // },


    // -----------------BIND MENU TO NODE-------------------
    bindNodeMenu: function (){
        $('.addNodeStyle').unbind('contextmenu');
        $('.addNodeStyle').bind("contextmenu",function(e){
            e.preventDefault();
            // var ptyp = this.id[(this.id.indexOf("_")+1)];
            // var portId = this.id.slice(this.id.indexOf("_") + 2);

            var nodeString = this.id;
            var nodeId = nodeString.replace(/\D/g, "");
            // console.log(nodeString);
            // console.log(nodeId)
            // var nodeId = this.id[(this.id.indexOf("_")+2)];
            var nodeIndex = nodeId - 1;
            
            // console.log(nodeIndex);
            // console.log(sysview.nodesArray);
            // return;

            sysview.nodePicked = nodeId;
            sysview.nodeStatPicked = sysview.node_info[nodeIndex].node_stat;
            // console.log ("NODESTAT = " + sysview.nodeStatPicked);
            // console.log ("NODENUMBER = " +sysview.nodePicked);
            // return;

            // remove previous css class
            $(".sysview_nodeActList > li").removeClass();
            $(".sysview_nodeActList > li").off('mouseenter mouseleave');;
            
            if (sysview.nodeStatPicked == "OOS") {
                sysview.activeAct(['actDiscover','actStartNode','actViewCmd']);
                sysview.deactiveAct(['actLockNode','actUnlockNode','actViewAlm','actStopNode','actFindFac','actFindCkid'])
                // sysview.actDiscover.hover(
                //     function () {$(this).addClass('activeAction')},
                //     function () {$(this).removeClass('activeAction')},
                // )
                // sysview.actStartNode.hover(
                //     function () {$(this).addClass('activeAction')},
                //     function () {$(this).removeClass('activeAction')},
                // )
                // sysview.actLockNode.addClass('disableAction');
                // sysview.actUnlockNode.addClass('disableAction');
                // sysview.actViewAlm.addClass('disableAction');
                // sysview.actStopNode.addClass('disableAction');
                
            }
            else if (sysview.nodeStatPicked == "INS") {
                sysview.activeAct(['actLockNode','actStopNode','actViewAlm','actFindFac','actFindCkid','actViewCmd'])
                sysview.deactiveAct(['actDiscover','actStartNode','actUnlockNode'])
                // sysview.actLockNode.hover(
                //     function () {$(this).addClass('activeAction')},
                //     function () {$(this).removeClass('activeAction')},
                // )
                // sysview.actUnlockNode.hover(
                //     function () {$(this).addClass('activeAction')},
                //     function () {$(this).removeClass('activeAction')},
                // )
                // sysview.actStopNode.hover(
                //     function () {$(this).addClass('activeAction')},
                //     function () {$(this).removeClass('activeAction')},
                // )
                // sysview.actViewAlm.hover(
                //     function () {$(this).addClass('activeAction')},
                //     function () {$(this).removeClass('activeAction')},
                // )
                // sysview.actDiscover.addClass('disableAction');
                // sysview.actStartNode.addClass('disableAction');
            }
            else if (sysview.nodeStatPicked == "UAS") {
                sysview.activeAct(['actDiscover','actViewCmd'])
                // sysview.actStopNode.addClass('disableAction');
                sysview.deactiveAct(['actStartNode','actLockNode','actUnlockNode','actViewAlm','actStopNode','actFindFac','actFindCkid'])
                // sysview.actDiscover.hover(
                //     function () {$(this).addClass('activeAction')},
                //     function () {$(this).removeClass('activeAction')},
                // )
                // sysview.actStartNode.addClass('disableAction');
                // sysview.actLockNode.addClass('disableAction');
                // sysview.actUnlockNode.addClass('disableAction');
                // sysview.actViewAlm.addClass('disableAction');
                // sysview.actStopNode.addClass('disableAction');
            }
            else if (sysview.nodeStatPicked == "LCK") {
                sysview.activeAct(['actUnlockNode','actViewCmd'])
                sysview.deactiveAct(['actStartNode', 'actLockNode', 'actDiscover', 'actViewAlm', 'actStopNode'])
            }


            

            sysview.showMenu('nodeMenu',e);   
        });
    },

    // ----------------BIND MENU TO MIO-----------------
    bindMioMenu: function (){
        $('.addMioStyle').unbind('contextmenu');
        $('.addMioStyle').bind("contextmenu",function(e) {
            e.preventDefault();
            
            // Obtain the MIO # of the MIO right mouse clicked on
            sysview.highlightedMio = $(this).attr("id").slice(12);
            sysview.highlightedMioPtyp = $(this).attr("id").slice(8, 12).toUpperCase();
            if (sysview.highlightedMioPtyp == "MIOX") {
                sysview.highlightedMioShelf = "1";
            }
            else if (sysview.highlightedMioPtyp == "MIOY") {
                sysview.highlightedMioShelf = "2";
            }

            sysview.mioStatPicked = $("#sysview_mio" + sysview.highlightedMioPtyp.slice(3,4) + sysview.highlightedMio + "_psta").text();

            // remove previous css class
            $(".sysview_mioActList > li").removeClass();
            $(".sysview_mioActList > li").off('mouseenter mouseleave');;

            if (sysview.mioStatPicked == "INS") {
                sysview.activeAct(['actRefresh', 'actLockCard', 'actViewPath']);
                sysview.deactiveAct(['actUnlockCard']);
            }
            else if (sysview.mioStatPicked == "LCK") {
                sysview.activeAct(['actUnlockCard', 'actViewPath']);
                sysview.deactiveAct(['actRefresh', 'actLockCard']);
            }
            else if (sysview.mioStatPicked == "OOS") {
                sysview.activeAct(['actViewPath']);
                sysview.deactiveAct(['actRefresh', 'actLockCard', 'actUnlockCard']);
            }

            sysview.showMenu('mioMenu',e);  
        });
    },

    // ------------------BIND MENU TO PORT--------------------
    bindPortMenu: function (){
        $('.addPortStyle').unbind('contextmenu');
        $('.addPortStyle').bind("contextmenu",function(e){
            e.preventDefault();
            //remove the previous class
            $('.addPortStyle').removeClass('addBorder');
            $(this).addClass('addBorder');
            var ptyp = this.id[(this.id.indexOf("_")+1)];
            var portId = this.id.slice(this.id.indexOf("_") + 2);

            if (ptyp == 'x') {
                var index = sysview.portX.findIndex(x => x.id === portId);
                sysview.portPicked = sysview.portX[index];
            } 
            else {
                var index = sysview.portY.findIndex(x => x.id === portId);
                sysview.portPicked = sysview.portY[index];
            }
            
            // remove previous css class
            $(".sysview_actList > li").removeClass();
            $(".sysview_actList > li").off('mouseenter mouseleave');
            // start add new css class
 

            if(sysview.portPicked.psta == 'UAS') {
                sysview.activeAct(['actMap']);
                sysview.actMap.siblings().addClass('disableAction');
            }
            else if(sysview.portPicked.psta == 'SF') {
                sysview.activeAct(['actUnmap','actDefected','actReserved']);
                sysview.deactiveAct(['actMap','actDiscMtc','actRestoreMtc','actRestoreMtcd','actTestMtc','actConMtc','actSF']);          
            }
            else if(sysview.portPicked.psta == 'MTCD') {
                sysview.activeAct(['actRestoreMtc', 'actConMtc']);
                sysview.deactiveAct(['actMap','actUnmap','actDefected','actReserved','actDiscMtc','actRestoreMtcd','actTestMtc','actSF']);
            }
            else if(sysview.portPicked.psta == 'CONN' || sysview.portPicked.psta == 'MLPT') {
                sysview.activeAct(['actDiscMtc']);
                sysview.actDiscMtc.siblings().addClass('disableAction');
            }
            else if(sysview.portPicked.psta == 'MAINT') {
                sysview.activeAct(['actRestoreMtcd']);
                sysview.actRestoreMtcd.siblings().addClass('disableAction');
            }
            else if(sysview.portPicked.psta == 'DEF' || sysview.portPicked.psta == 'RS'
                || sysview.portPicked.psta == 'TST') {
                sysview.activeAct(['actConMtc','actSF']);
                sysview.deactiveAct(['actRestoreMtc','actMap','actUnmap','actDefected','actReserved','actDiscMtc','actRestoreMtcd','actTestMtc']);
            }
            else {
                $(".sysview_actList > li").addClass('disableAction');
            }

            //-----------------Only for viewCkid
            sysview.actViewCkid.removeClass();
            sysview.actViewCkid.off('mouseenter mouseleave');

            if(sysview.portPicked.ckid != ''){
                sysview.activeAct(['actViewCkid']);
            }
            else {
                sysview.deactiveAct(['actViewCkid']);              
            }

            sysview.showMenu('portMenu',e);

        });
    },

    // ---------------display menu--------------------
    showMenu: function(menuVariable,e) {
        if((e.clientX +sysview[menuVariable].width()) > document.body.clientWidth)
            sysview[menuVariable].css("left",e.clientX - sysview[menuVariable].width());
        else 
            sysview[menuVariable].css("left",e.clientX);

        if((e.clientY +sysview[menuVariable].height()) > document.body.clientHeight)
            sysview[menuVariable].css("top",e.clientY - sysview[menuVariable].height());
        else 
            sysview[menuVariable].css("top",e.clientY);

            sysview[menuVariable].fadeIn(200);   
    },

    populateMapForm: function() {
        pmModal.node.val(sysview.portPicked.node);
        pmModal.slot.val(sysview.portPicked.slot);
        pmModal.pnum.val(sysview.portPicked.pnum);
        pmModal.ptyp.val(sysview.portPicked.ptyp);
        pmModal.psta.val(sysview.portPicked.psta);
        pmModal.fac.val(sysview.portPicked.fac);
        pmModal.act.val(sysview.portAct); 
    },

    populateMtcForm: function() {
        maintModal.ckid.val(sysview.portPicked.ckid);
        maintModal.cls.val("");
        maintModal.adsr.val("");
        maintModal.prot.val("");
        maintModal.mlo.val("");

        //for discon Form
        maintModal.discCtyp.val(sysview.connPicked.ctyp);
        maintModal.discFFac.val(sysview.connPicked.ffac);
        maintModal.discTFac.val(sysview.connPicked.tfac);

        //for reConnect form
        maintModal.ctyp.val(sysview.connPicked.ctyp);
        maintModal.ffac.val(sysview.connPicked.ffac);
        maintModal.tfac.val(sysview.connPicked.tfac);

        //for newConnect form
        maintModal.fCtyp.val(sysview.connPicked.ctyp);
        maintModal.tCtyp.val(sysview.connPicked.ctyp);
        maintModal.conFacX.val(sysview.connPicked.ffac);
        maintModal.conFacY.val(sysview.connPicked.tfac);

        //for testPort form
        maintModal.testFCtyp.val(sysview.connPicked.ctyp);
        maintModal.testTCtyp.val(sysview.connPicked.ctyp);
        maintModal.conTestFacX.val(sysview.connPicked.ffac);
        maintModal.conTestFacY.val(sysview.connPicked.tfac);

        maintModal.oldContyp.val(sysview.connPicked.ctyp);
        maintModal.newContyp.val(sysview.connPicked.ctyp);

        maintModal.oldFfac.val(sysview.connPicked.ffac);
        maintModal.oldPortX.val(sysview.connPicked.fport);
        maintModal.oldTfac.val(sysview.connPicked.tfac);
        maintModal.oldPortY.val(sysview.connPicked.tport);
        ////////////////////


        maintModal.act.val(sysview.portAct);
        maintModal.dd.val("");
        maintModal.fdd.val("");
    },

    startShowMap: function() {
        sysviewModal.showConn.hide();
        sysviewModal.showMap.show();
        sysviewModal.clearForm();
        sysview.populatePortForm();
    },

    populatePortForm: function() {
        sysviewModal.portMap.val(sysview.portPicked.port);
        sysviewModal.ptypMap.val(sysview.portPicked.ptyp);
        sysviewModal.pstaMap.val(sysview.portPicked.psta);

    },
    
    
    activeAct: function(actArray) {
        for(var i=0; i<actArray.length; i++) {
            var actVariable = actArray[i];
            sysview[actVariable].hover(
                function () {$(this).addClass('activeAction')},
                function () {$(this).removeClass('activeAction')},
            )
        }
    },

    deactiveAct: function(actArray){
        for(var i=0; i<actArray.length; i++) {
            var actVariable = actArray[i];
            sysview[actVariable].addClass('disableAction');
        }
    },

    hoverEvent: {
        node: function() {
            $(".sysview_nodeX button, .sysview_nodeY button").hover(function() {
                if ($(this).parent().attr('id') == "sysview_nodeX") {
                    if ($(this).attr('id') == sysview.nodeXActiveId) {
                        return;
                    }
                    else {
                        $(this).addClass("addBGColor");

                    }
                }
                else {
                    if ($(this).attr('id') == sysview.nodeYActiveId) {
                        return;

                    }
                    else {
                        $(this).addClass("addBGColor");

                    }
                }
            }, function() {
                if ($(this).parent().attr('id') == "sysview_nodeX") {
                    if ($(this).attr('id') == sysview.nodeXActiveId) {                      
                        return;
                    }
                    else {                     
                        $(this).removeClass("addBGColor");
                    }
                }
                else {
                    if ($(this).attr('id') == sysview.nodeYActiveId) {                   
                        return;
                    }
                    else {
                        $(this).removeClass("addBGColor");
                    }
                }
            });
        },

        mio: function() {
            $(".sysview_mio button").hover(function() {
                var ptyp = String(this.id.slice(this.id.indexOf("_") + 4));
                ptyp = ptyp.slice(0, 1);
                if (ptyp == "X") {
                    if ($(this).attr('id') == sysview.activeMioX) {
                        return;
                    }
                    else {
                        $(this).addClass("addBGColor");
                    }
                }
                else {
                    if ($(this).attr('id') == sysview.activeMioY) {
                        return;
                    }
                    else {
                        $(this).addClass("addBGColor");
                    }
                }
            }, function() {
                var ptyp = String(this.id.slice(this.id.indexOf("_") + 4));
                ptyp = ptyp.slice(0, 1);
                if (ptyp == "X") {
                    if ($(this).attr('id') == sysview.activeMioX) {
                        return;
                    }
                    else {
                        $(this).removeClass("addBGColor");
                    }
                }
                else {
                    if ($(this).attr('id') == sysview.activeMioY) {
                        return;
                    }
                    else {
                        $(this).removeClass("addBGColor");
                    }
                }
            });
        }
    }
}

var sysviewModal = {
    modal:  $("#sysviewModal"),

    showConn:   $("#sysviewModal_showConn"),
    ckid:       $("#sysviewModal_ckid_txt"),

    port:   [],
    fac:    [],
    psta:   [],
    ftyp:   [],

    showMap:    $("#sysviewModal_showMap"),
    portMap:    $("#sysviewModal_port_txt"),
    ptypMap:    $("#sysviewModal_ptyp_txt"),
    pstaMap:    $("#sysviewModal_psta_txt"),

    cls:        $("#sysviewModal_cls_txt"),
    adsr:       $("#sysviewModal_adsr_txt"),
    prot:       $("#sysviewModal_prot_txt"),

    act:        $("#sysviewModal_act_txt"),
    submitBtn:  $("#sysviewModal_submit_btn"),

    connections: $("#sysviewModal_connections"),



    startShowConn: function() {
        sysviewModal.showConn.show();
        sysviewModal.showMap.hide();
        // sysviewModal.addConnections();
        // sysviewModal.populateConnForm();
    },

    populateConnForm: function() {
        sysviewModal.ckid.val(sysview.ckidRows[0].ckid);

        for (var i = 0; i < sysview.ckidRows.length; i++) {
            // console.log(sysviewModal.psta[i]);
            // console.log(sysviewModal.psta[i].val(sysview.ckidRows[i].psta));
            // console.log(sysviewModal.port[i]);
            // console.log(sysviewModal.port[i].val(sysview.ckidRows[i].port));
            // console.log(sysviewModal.fac[i]);
            // console.log(sysviewModal.fac[i].val(sysview.ckidRows[i].fac));
            // console.log(sysviewModal.ftyp[i]);
            // console.log(sysviewModal.ftyp[i].val(sysview.ckidRows[i].ftyp));
            $(sysviewModal.psta[i]).val(sysview.ckidRows[i].psta);
            $(sysviewModal.port[i]).val(sysview.ckidRows[i].port);
            $(sysviewModal.fac[i]).val(sysview.ckidRows[i].fac);
            $(sysviewModal.ftyp[i]).val(sysview.ckidRows[i].ftyp);
        }
    },

    addConnections: function() {
        var a = [];
        for (var i = 0; i < sysview.ckidRows.length; i++) {
            a.push('<div class="row">');
                a.push('<div class="col-sm-3">');
                    a.push('<input id="sysviewModal_psta' + i + '_txt" style="text-transform: uppercase" type="text" class="form-control">')
                a.push('</div>');
                a.push('<div class="col-sm-3">');
                    a.push('<input id="sysviewModal_port' + i + '_txt" style="text-transform: uppercase" type="text" class="form-control">')
                a.push('</div>');
                a.push('<div class="col-sm-3">');
                    a.push('<input id="sysviewModal_fac' + i + '_txt" style="text-transform: uppercase" type="text" class="form-control">')
                a.push('</div>');
                a.push('<div class="col-sm-3">');
                    a.push('<input id="sysviewModal_ftyp' + i + '_txt" style="text-transform: uppercase" type="text" class="form-control">')
                a.push('</div>');
            a.push('</div>')
            
            sysviewModal.connections.html(a.join(""));


            sysviewModal.psta.push('#sysviewModal_psta' + i + '_txt');
            sysviewModal.port.push('#sysviewModal_port' + i + '_txt');
            sysviewModal.fac.push('#sysviewModal_fac' + i + '_txt');
            sysviewModal.ftyp.push('#sysviewModal_ftyp' + i + '_txt');
        }
    },

    clearForm: function() {
        sysviewModal.ckid.val("");

        sysviewModal.psta = [];
        sysviewModal.port = [];
        sysviewModal.fac = [];
        sysviewModal.ftyp = [];

        sysviewModal.portMap.val('');
        sysviewModal.ptypMap.val('');
        sysviewModal.pstaMap.val('');

        sysviewModal.act.val('');
        sysviewModal.connections.empty();

    },


    submit: {

        updateStatPort: function(action) {
            $.post(ipcDispatch,
            {
                api:    "ipcPortmap",
                act:	action,
                user:	$('#main_currentUser').text(),
                port:   sysview.portPicked.port,
                
            },
            function (data, status) {
                var obj = JSON.parse(data);
                if (obj.rslt == "fail") {
                    alert(obj.reason);
                }
                else {
                    alert(obj.rslt + " - " + obj.reason);
                    sysview.queryX(sysview.partXNum);
                    sysview.queryY(sysview.partYNum);
                    sysviewModal.modal.modal('hide');
                }
            });
        },
    }

}

var sysviewModal_facSearch = {
    modal:          $("#sysviewModal_facSearch"),
    fac:            $("#sysviewModal_facSearch_fac_txt"),
    facSearchBtn:   $("#sysviewModal_facSearch_facSearch_btn"),

    query: function(fac) {
    /**
     * 1) Post to ipcPortMap: action = "findPortByFac"
     * 2) From the return obj.rows, get the port
     *    For Example: (1-3-X-24)
     * 3) Split the port to get the: Node, Slot, and Type
     *    For the above example: node = 1, slot = 3, and type = x
     * 4) Post queryMio with node = 1, slot = 3, and type = x to get the entire 50 ports
     * 5) Display the 50 ports and highlight the port (1-3-X-24) icon
     * */
    
        $.post(ipcDispatch,
        {
            api:    "ipcPortmap",
            act:    "findFac",
            user:   $("#main_currentUser").text(),
            fac:    fac,
        },
        function(data, status) {
            var obj = JSON.parse(data);
            if (obj.rslt == "fail") {
                alert(obj.reason);
            }
            else {
                if (obj.rows.length === 0) {
                    alert(`FAC: ${sysviewModal_facSearch.fac.val()} <br> DOES NOT EXIST`);
                    return;
                }
                sysview.facRows = obj.rows;
                var port = sysview.facRows[0].port.split("-");
                sysview.facNode = port[0];
                sysview.facSlot = port[1];
                sysview.facType = port[2];
                sysview.facPort = port[3];

                sysview.facPort = parseInt(sysview.facPort);
                if (sysview.facPort < 26) {
                    sysview.part = 1;
                }
                else if (sysview.facPort > 25) {
                    sysview.part = 2;
                }

                // First query based on the information of the chosen FAC
                // console.log(sysview.part);
                // console.log(sysview.facNode);
                // console.log(sysview.facSlot);
                // console.log(sysview.facType);
                sysview.query(fac, sysview.part, sysview.facNode, sysview.facSlot, sysview.facType);

            }
        });
    }
}

var sysviewModal_ckidSearch = {
    modal:          $("#sysviewModal_ckidSearch"),
    ckid:           $("#sysviewModal_ckidSearch_ckid_txt"),
    ckidSearchBtn:  $("#sysviewModal_ckidSearch_ckidSearch_btn"),
    tbl: {
        body:       $("#sysviewModal_ckidSearch_tbl"),
        index:      0,
        maxIndex:   0,
    },

    displayTbl: function(index) {   
        var startIndex=(index - 1) * 100;
        var stopIndex = index * 100;
        var len = sysview.ckidRows.length;

        if (len>=startIndex) {
            if (len < stopIndex) {
                stopIndex = len;   
            }         
            sysviewModal_ckidSearch.tbl.body.empty();
            var a = [];
            for (var i = startIndex; i < stopIndex; i++) {  
                a.push('<tr> <td style="width:5%">'    + sysview.ckidRows[i].idx  + '</td>');
                a.push('<td style="width:10%">'        + sysview.ckidRows[i].ctyp + '</td>');
                a.push('<td style="width:10%">'        + sysview.ckidRows[i].fport + '</td>');
                a.push('<td style="width:10%">'        + sysview.ckidRows[i].fpsta + '</td>');
                a.push('<td style="width:22%">'        + sysview.ckidRows[i].ffac + '</td>');
                a.push('<td style="width:10%">'        + sysview.ckidRows[i].tport + '</td>');
                a.push('<td style="width:10%">'        + sysview.ckidRows[i].tpsta + '</td>');
                a.push('<td style="width:23%">'        + sysview.ckidRows[i].tfac + '</td></tr>');
                
            }
            sysviewModal_ckidSearch.tbl.body.html(a.join(""));
        } 
    },

    queryByCkid: function(ckid) {
    
        $.post(ipcDispatch,
        {
            api:    "ipcProv",
            act:	"queryCktconByCkid",
            user:	$("#main_currentUser").text(),
            ckid:   ckid,
        },
        function (data, status) {
            var obj = JSON.parse(data);
            if (obj.rslt  ==  "fail") {
                alert(obj.reason);
            }
            else {
                sysviewModal_ckidSearch.tbl.index = 0;
                sysview.ckidRows = obj.rows;
                var len = sysview.ckidRows.length;
                sysviewModal_ckidSearch.tbl.maxIndex = Math.ceil(len/100.0);
                sysviewModal_ckidSearch.tbl.index++;
                sysviewModal_ckidSearch.displayTbl(sysviewModal_ckidSearch.tbl.index);
                sysviewModal.modal.modal();
                sysviewModal.ckid.val(ckid);
                sysviewModal.startShowConn();
                sysviewModal.cls.val(sysview.ckidRows[0].cls);
                sysviewModal.adsr.val(sysview.ckidRows[0].adsr);
                sysviewModal.prot.val(sysview.ckidRows[0].prot);               
            }
        });

    },
}

var sysviewModal_viewPath = {
    modal:          $("#sysviewModal_viewPath"),
    node:           $("#sysviewModal_viewPath_node_txt"),
    slot:           $("#sysviewModal_viewPath_slot_txt"),
    viewBtn:        $("#sysviewModal_viewPath_view_btn"),

    tblRows:        [],
    tbl: {
        body:       $("#sysviewModal_viewPath_table"),
        index:      0,
        maxIndex:   0,
        headers: {
            id:     $("#sysviewModal_viewPath_ID_tbl"),
            stat:   $("#sysviewModal_viewPath_STAT_tbl"),
            ckid:   $("#sysviewModal_viewPath_CKID_tbl"),
            idx:    $("#sysviewModal_viewPath_IDX_tbl"),
            port_x: $("#sysviewModal_viewPath_PORT_X_tbl"),
            port_y: $("#sysviewModal_viewPath_PORT_Y_tbl"),
            path:   $("#sysviewModal_viewPath_PATH_tbl"),
        }
    },

    headers: {
        id:         true,
        stat:       true,
        ckid:       true,
        idx:        true,
        port_x:     true,
        port_y:     true,
        path:       true,
    },
    
    queryByNode: function() {
        $.post(ipcDispatch,
        {
            api:    "ipcPath",
            act:    "queryByNode",
            user:   mB.loginUser.text(),
            node:   sysviewModal_viewPath.node.val(),
            slot:   sysviewModal_viewPath.slot.val(),
        },
        
        function (data, status) {
            var obj = JSON.parse(data);
            if(obj.rslt == "fail") {
                alert(obj.reason);
            }
            else {
                if (obj.rows.length == 0) {
                    alert("NO PATH FOUND ON " + sysview.highlightedMioPtyp + "-" + sysview.highlightedMio + " OF NODE-" + sysviewModal_viewPath.node.val());
                }
                else {
                    sysviewModal_viewPath.tbl.index = 0;
                    sysviewModal_viewPath.tblRows = obj.rows;
                    var len = sysviewModal_viewPath.tblRows.length;
                    sysviewModal_viewPath.tbl.maxIndex = Math.ceil(len/100.0);
                    sysviewModal_viewPath.tbl.index++;
                    sysviewModal_viewPath.displayTable(sysviewModal_viewPath.tbl.index);
                    sysviewModal_viewPath.modal.modal();
                }
            }
        });

    },
    
    displayTable: function(index) {
        var startIndex = (index - 1) * 100;
        var stopIndex = index * 100;
        var len = sysviewModal_viewPath.tblRows.length;
      
        if (len >= startIndex) {
            if (len < stopIndex) {
                stopIndex = len;
            }
            sysviewModal_viewPath.tbl.body.empty();
            var a = [];
            var displayedRows = sysviewModal_viewPath.tblRows;
            var tableHeader = ['id', 'ctyp', 'ckid', 'idx', 'x', 'y', 'path'];
            for (var i = startIndex; i < stopIndex; i++) {
                for (let j = 0; j < tableHeader.length; j++) {
                    if (displayedRows[i][tableHeader[j]]== undefined || displayedRows[i][tableHeader[j]] == null) {
                        displayedRows[i][tableHeader[j]] = "";
                    }
                }
                a.push('<tr> <td style="width:5%">' + sysviewModal_viewPath.tblRows[i].id + "</td>");
                a.push('<td style="width:5%">'      + sysviewModal_viewPath.tblRows[i].ctyp + "</td>");
                a.push('<td style="width:15%">'     + sysviewModal_viewPath.tblRows[i].ckid + "</td>");
                a.push('<td style="width:5%">'      + sysviewModal_viewPath.tblRows[i].idx + "</td>");
                a.push('<td style="width:7%">'      + sysviewModal_viewPath.tblRows[i].x + "</td>");
                a.push('<td style="width:8%">'      + sysviewModal_viewPath.tblRows[i].y + "</td>");
                a.push('<td style="width:55%">'     + sysviewModal_viewPath.tblRows[i].path + "</td></tr>");
            }
            sysviewModal_viewPath.tbl.body.html(a.join(""));
            sysviewModal_viewPath.sortHeaderEvents();
        }
    },
    
    // FUNCTION TO SORT TABLE 
    // REQUIRES THE PROPERTY OF THE OBJECT IN THE ARRAY, 
    // PUTTING A "-" IN FRONT OF THE PROPERTY WILL SORT DESCENDING
    dynamicSort: function(property) {
        var sortOrder = 1;

        if (property[0] === "-") {
            sortOrder = -1;
            property = property.substr(1);
        }
        return function (a,b) {
            if (sortOrder == -1) {
                return b[property].localeCompare(a[property]);
            }
            else {
                return a[property].localeCompare(b[property]);
            }        
        }
    },

    sortHeaderEvents: function() {
        for (let elem in sysviewModal_viewPath.tbl.headers) {
            sysviewModal_viewPath.tbl.headers[elem].click(function() {
                if (sysviewModal_viewPath.tblRows.length != 0) {
                    if (sysviewModal_viewPath.headers.elem) {
                        sysviewModal_viewPath.tblRows = sysviewModal_viewPath.tblRows.sort(sysviewModal_viewPath.dynamicSort(`${elem}`));
                        sysviewModal_viewPath.headers.elem = false;
                    }
                    else {
                        sysviewModal_viewPath.tblRows = sysviewModal_viewPath.tblRows.sort(sysviewModal_viewPath.dynamicSort(`-${elem}`));
                        sysviewModal_viewPath.headers.elem = true;
                    }
                    sysviewModal_viewPath.displayTable(sysviewModal_viewPath.tbl.index);
                }
            });
        }
    },


    
}

var sysviewMxcModal = {
    modal:      $("#sysviewMxcModal"),
    node:       $("#sysviewMxcModal_node_txt"),
    shelf:      $("#sysviewMxcModal_shelf_txt"),
    slot:       $("#sysviewMxcModal_slot_txt"),
    type:       $("#sysviewMxcModal_type_txt"),
    stat:       $("#sysviewMxcModal_stat_txt"),
    act:        $("#sysviewMxcModal_act_txt"),

    submitBtn:  $("#sysviewMxcModal_submit_btn"),
    closeBtn:   $("#sysviewMxcModal_close_btn"),
    
    
    submit: function(action){
        $.post(ipcDispatch,
        {     
            api:    "ipcMxc",
            act:    action,
            user:   $('#main_currentUser').text(),
            node:   sysviewMxcModal.node.val(),
            shelf:  sysviewMxcModal.shelf.val(),
            slot:   sysviewMxcModal.slot.val(),
            type:   sysviewMxcModal.type.val(),
            stat:   sysviewMxcModal.stat.val()
        },
        function (data, status) {       
            var obj = JSON.parse(data);
            if (obj.rslt == "fail") {
                alert("FAIL: " + obj.reason);
            }
            else {
                alert(obj.reason);
                sysviewMxcModal.modal.modal('hide');
                // extract type from returned type, (expecting MIO infront of type)
                var ptyp = obj.rows.type.slice(3);

                // Inserting new psta into appropriate MIO tab
                $("#sysview_mio" + ptyp + obj.rows.slot + "_psta").text(obj.rows.psta);
                
                // Only update port side that is affected by LCK / UNLCK MXC
                if (ptyp == "X") {
                    sysview.queryX(sysview.partXNum);
                }
                else if (ptyp == "Y") {
                    sysview.queryY(sysview.partYNum);
                }
            }
        });
    }    

}

var sysviewNodeModal = {
    modal:          $("#sysviewNodeModal"),
    node:           $("#sysviewNodeModal_nodeId_num"),
    nodeStatus:     $("#sysviewNodeModal_status_txt"),
    act:            $("#sysviewNodeModal_act_txt"),
    submitBtn:      $("#sysviewNodeModal_submit_btn"),

    submit: {
        lockNode: function() {
            $.post(ipcDispatch,
            {
                api:    "ipcMxc",
                act:    'lck_node',
                user:   $('#main_currentUser').text(),
                node:   sysviewNodeModal.node.val(),
            },
            function (data, status) {
                var obj = JSON.parse(data);
                if (obj.rslt == "fail") {
                    alert("FAIL: " + obj.reason);
                }
                else {
                    alert(obj.reason);
                }
            });
        },

        unlockNode: function() {
            $.post(ipcDispatch,
            {
                api:    "ipcMxc",
                act:    'unlck_node',
                user:   $('#main_currentUser').text(),
                node:   sysviewNodeModal.node.val(),
            },
            function (data, status) {
                var obj = JSON.parse(data);
                if (obj.rslt == "fail") {
                    alert("FAIL: " + obj.reason);
                }
                else {
                    alert(obj.reason);
                }
            });
        },

        discoverNode: function() {
            $.post(ipcDispatch,
            {
                api:    "ipcNodeAdmin",
                act:    'DISCOVER_NODE',
                user:   $('#main_currentUser').text(),
                node:   sysviewNodeModal.node.val(),
            },
            function (data, status) {
                var obj = JSON.parse(data);
                if (obj.rslt == "fail") {
                    alert("FAIL: " + obj.reason);
                }
                else {
                    alert(obj.reason);
                }
            });
        },

        startNode: function() {
            $.post(ipcDispatch,
            {
                api:    "ipcNodeAdmin",
                act:    'START_NODE',
                user:   $('#main_currentUser').text(),
                node:   sysviewNodeModal.node.val(),
            },
            function (data, status) {
                var obj = JSON.parse(data);
                if (obj.rslt == "fail") {
                    alert("FAIL: " + obj.reason);
                }
                else {
                    alert(obj.reason);
                }
            });
        },

        stopNode: function() {
            $.post(ipcDispatch,
            {
                api:    "ipcNodeAdmin",
                act:    'STOP_NODE',
                user:   $('#main_currentUser').text(),
                node:   sysviewNodeModal.node.val(),
            },
            function (data, status) {
                var obj = JSON.parse(data);
                if (obj.rslt == "fail") {
                    alert("FAIL: " + obj.reason);
                }
                else {
                    alert(obj.reason);
                }
            });
        },
    }


}

var sysviewCmdModal = {

    modal:      $("#sysviewCmdModal"),
    ackid:      $("#sysviewCmdModal_ackid_txt"),
    cmd:        $("#sysviewCmdModal_cmd_txt"),
    act:        $("#sysviewCmdModal_act_txt"),
    stat:       $("#sysviewCmdModal_stat_txt"),
    submitBtn:  $("#sysviewCmdModal_submit_btn"),

    tblRows:    [],
    tbl: {
        body:       $("#sysviewCmdModal_tbl"),
        index:      0,
        maxIndex:   0,
    },

    viewCmd: function(action) {

        $.post(ipcDispatch,
        {
            api:    "ipcNodeOpe",
            act:    'VIEW CMD',
            user:   $('#main_currentUser').text(),
            node:   sysview.nodePicked,
        },
        function (data, status) {
            var obj = JSON.parse(data);
            if (obj.rslt  ==  "fail") {
                alert(obj.reason);
            }
            else {
                sysviewCmdModal.tbl.index = 0;
                sysviewCmdModal.tblRows = obj.rows;
                var len = sysviewCmdModal.tblRows.length;
                sysviewCmdModal.tbl.maxIndex = Math.ceil(len/25.0);
                sysviewCmdModal.tbl.index++;
                //put data into an array so that we can populate table in cmdModal
                sysviewCmdModal.displayTbl(sysviewCmdModal.tbl.index);
                sysviewCmdModal.act.val("VIEW CMD");
                sysviewCmdModal.modal.modal();
            }
        });
    },

    exec_cmd: function() {

        $.post(ipcDispatch,
        {
            api:    "ipcNodeOpe",
            act:    'EXEC_CMD',
            user:   $('#main_currentUser').text(),
            node:   sysview.nodePicked,
            cmd:    sysviewCmdModal.cmd.val(),
        },
        function (data, status) {
            var obj = JSON.parse(data);
            if (obj.rslt  ==  "fail") {
                alert(obj.reason);
            }
            else {
                alert(obj.reason, function() {
                    sysviewCmdModal.modal.modal('hide');
                    setTimeout(function() {
                        $("#alertLayer").hide();
                        sysviewCmdModal.viewCmd();
                    }, 5000);
                }, true);
            }
        });
    },

    displayTbl: function(index) {   
        var startIndex=(index - 1) * 100;
        var stopIndex = index * 100;
        var len = sysviewCmdModal.tblRows.length;

        if (len >= startIndex) {
            if (len < stopIndex) {
                stopIndex = len;   
            }         
            sysviewCmdModal.tbl.body.empty();
            var a = [];
            for (var i = startIndex; i < stopIndex; i++) {  
                a.push('<tr>');
                a.push('<td style="width:10%">'    + sysviewCmdModal.tblRows[i].ackid  + '</td>');
                a.push('<td style="width:80%">'    + sysviewCmdModal.tblRows[i].cmd    + '</td>');
                a.push('<td style="width:10%">'    + sysviewCmdModal.tblRows[i].stat   + '</td>');
                a.push('</tr>');
                
            }
            sysviewCmdModal.tbl.body.html(a.join(""));
        } 
    },

    

}
// Handles when a node icon is clicked on either the X or Y side
$(document).on("click",".sysview_nodeX button, .sysview_nodeY button",function() {

    //Add border to the row
    $(this).addClass("addBGColor"); //add class selected to current clicked row
    $(this).siblings().removeClass( "addBGColor" ); //remove class selected from rest of the rows  

    // Saves the id of icon clicked
    sysview.nodeActive = $(this).attr('id');
    // Saves the node index of the icon clicked
    sysview.nodeIndex = parseInt(sysview.nodeActive.slice(13));
    // Saves the side that the icon clicked was on
    sysview.nodeSide = sysview.nodeActive.slice(12,13);

    // Will execute code based on the side of the clicked node icon
    if (sysview.nodeSide == "X") {
        sysview.nodeXActiveId = $(this).attr('id');
        sysview.nodeXActive = sysview.nodeIndex;

        // Resets the formatting active X MIO icon
        // sysview.mioType = "X";
        sysview.mioXIndex  = 1;
        sysview.mioX1.addClass("addBGColor");
        sysview.mioX1.addClass("activeMioStyle");
        sysview.mioX1.siblings().removeClass("addBGColor");
        sysview.mioX1.siblings().removeClass("activeMioStyle");
        sysview.queryX(sysview.partXNum);
        sysview.activeMioX = sysview.mioX1.attr('id');
        // Updates the psta on the MIO tabs
        for (i = 0; i < sysview.mioXPsta.length; i++) {
            $("#" + sysview.mioXPsta[i].attr('id')).text(sysview.node_info[sysview.nodeXActive - 1].MIOX[i]);
        }
    }
    else {
        sysview.nodeYActiveId = $(this).attr('id');
        sysview.nodeYActive = sysview.nodeIndex;

        // Resets the formatting active Y MIO icon
        // sysview.mioType = "Y";
        sysview.mioYIndex  = 1;
        sysview.mioY1.addClass("addBGColor");
        sysview.mioY1.addClass("activeMioStyle");
        sysview.mioY1.siblings().removeClass("addBGColor");
        sysview.mioY1.siblings().removeClass("activeMioStyle");
        sysview.queryY(sysview.partYNum);
        sysview.activeMioY = sysview.mioY1.attr('id');
        // Updates the psta on the MIO tabs
        for (i = 0; i < sysview.mioYPsta.length; i++) {
            $("#" + sysview.mioYPsta[i].attr('id')).text(sysview.node_info[sysview.nodeYActive - 1].MIOY[i]);
        }

    }
    //change mio and XY to default
    sysview.xy  = 'x';
    sysview.x.addClass("addBGColor")
    sysview.x.siblings().removeClass("addBGColor")

    
});

// Handles when an "MIO" icon is clicked
$(document).on("click",".sysview_mio button",function() {

    //Add border to the row
    $(this).addClass("addBGColor"); //add class selected to current clicked row
    $(this).addClass("activeMioStyle"); //add class selected to current clicked row
    $(this).siblings().removeClass( "addBGColor" ); //remove class selected from rest of the rows  
    $(this).siblings().removeClass( "activeMioStyle" ); //remove class selected from rest of the rows  

    // Extracts ptyp from the ID of the icon clicked
    var ptyp = String(this.id.slice(this.id.indexOf("_") + 4));
    ptyp = ptyp.slice(0, 1);

    // Updates variables to save the current MIO type and Index
    // Will query ports on appropriate side using the "part" number saved
    // Will save the clicked MIO as the active MIO of each side (X / Y)
    if (ptyp == "X") {
        // sysview.mioType = "X";
        sysview.mioXIndex = parseInt(this.id.slice(this.id.indexOf("_") + 5));
        sysview.queryX(sysview.partXNum);
        sysview.activeMioX = $(this).attr('id');
    }
    else if (ptyp == "Y") {
        // sysview.mioType = "Y";
        sysview.mioYIndex = parseInt(this.id.slice(this.id.indexOf("_") + 5));
        sysview.queryY(sysview.partYNum);
        sysview.activeMioY = $(this).attr('id');
    }
    //change XY to default
    // Not sure if this is needed anymore
    sysview.xy = 'x';
    sysview.x.addClass("addBGColor");
    sysview.x.siblings().removeClass("addBGColor");
});


// Handles when a "part" icon is clicked on either the X or Y side
$(document).on("click",".sysview_part a",function() {

    //Add border to the row
    $(this).addClass("addBorder"); //add class selected to current clicked row
    $(this).siblings().removeClass( "addBorder" ); //remove class selected from rest of the rows  
    
    sysview.part = String(this.id.slice(this.id.indexOf("_") + 1));
    sysview.part = parseInt(sysview.part.slice(0, 1));

    var ptyp = String(this.id.slice(this.id.indexOf("_") + 2));

    if (ptyp == "X") {
        sysview.partXNum = sysview.part;
        sysview.createPortX(sysview.partXNum);
    }
    else if (ptyp == "Y") {
        sysview.partYNum = sysview.part;
        sysview.createPortY(sysview.partYNum);
    }
   
    // sysview.queryX(sysview.part);
    // sysview.queryY(sysview.part);
});

sysviewModal.modal.on("hidden.bs.modal", sysviewModal.clearForm);


// Handles when a menu item is clicked on the Node right click menu
$(".sysview_nodeActList > li").click(function(){
    if($(this).hasClass('disableAction')){
        return;
    }
    else {
        if($(this).text() == 'VIEW_ALARM') {
            mB.alm.click();
        }
        else if($(this).text() == 'LOCK_NODE') {
            sysviewNodeModal.node.prop('disabled', true);
            sysviewNodeModal.nodeStatus.prop('disabled', true);
            sysviewNodeModal.node.val(sysview.nodePicked);
            sysviewNodeModal.nodeStatus.val(sysview.nodeStatPicked);
            sysviewNodeModal.act.val('LCK_NODE');
            sysviewNodeModal.modal.modal();
        }
        else if($(this).text() == 'UN-LOCK_NODE') {
            sysviewNodeModal.node.prop('disabled', true);
            sysviewNodeModal.nodeStatus.prop('disabled', true);
            sysviewNodeModal.node.val(sysview.nodePicked);
            sysviewNodeModal.nodeStatus.val(sysview.nodeStatPicked);
            sysviewNodeModal.act.val('UN-LCK_NODE')
            sysviewNodeModal.modal.modal();
        }
        else if($(this).text() == 'DISCOVER_NODE') {
            sysviewNodeModal.node.prop('disabled', true);
            sysviewNodeModal.nodeStatus.prop('disabled', true);
            sysviewNodeModal.node.val(sysview.nodePicked);
            sysviewNodeModal.nodeStatus.val(sysview.nodeStatPicked);
            sysviewNodeModal.act.val('DISCOVER_NODE');
            sysviewNodeModal.modal.modal();
        }
        else if($(this).text() == 'START_NODE') {
            sysviewNodeModal.node.prop('disabled', true);
            sysviewNodeModal.nodeStatus.prop('disabled', true);
            sysviewNodeModal.node.val(sysview.nodePicked);
            sysviewNodeModal.nodeStatus.val(sysview.nodeStatPicked);
            sysviewNodeModal.act.val('START_NODE');
            sysviewNodeModal.modal.modal();
        }
        else if($(this).text() == 'STOP_NODE') {
            sysviewNodeModal.node.prop('disabled', true);
            sysviewNodeModal.nodeStatus.prop('disabled', true);
            sysviewNodeModal.node.val(sysview.nodePicked);
            sysviewNodeModal.nodeStatus.val(sysview.nodeStatPicked);
            sysviewNodeModal.act.val('STOP_NODE');
            sysviewNodeModal.modal.modal();
        }
        else if($(this).text() == 'FIND FAC') {
            sysviewModal_facSearch.modal.modal();
        }
        else if($(this).text() == 'FIND CKID') {
            sysviewModal_ckidSearch.modal.modal();
        }
        else if ($(this).text() == 'VIEW CMD') {
            sysviewCmdModal.viewCmd();
        }
    }
});


// Handles when a menu item is clicked on the MIO right click menu
$(".sysview_mioActList > li").click(function(){

    if ($(this).text() == 'REFRESH') {

    }
    else if ($(this).text() == 'LOCK CARD') {
        sysviewMxcModal.modal.modal();
        sysviewMxcModal.node.val(String(sysview.nodeIndex));
        sysviewMxcModal.slot.val(sysview.highlightedMio);
        sysviewMxcModal.type.val(sysview.highlightedMioPtyp);
        sysviewMxcModal.act.val("LCK");
        sysviewMxcModal.shelf.val(sysview.highlightedMioShelf);

    }
    else if ($(this).text() == 'UNLOCK CARD') {
        sysviewMxcModal.modal.modal();
        sysviewMxcModal.node.val(String(sysview.nodeIndex));
        sysviewMxcModal.slot.val(sysview.highlightedMio);
        sysviewMxcModal.type.val(sysview.highlightedMioPtyp);
        sysviewMxcModal.act.val("UN-LCK");
        sysviewMxcModal.shelf.val(sysview.highlightedMioShelf);

        
    }
    else if ($(this).text() == 'VIEW PATH') {
        sysviewModal_viewPath.node.val(sysview.nodeIndex);
        sysviewModal_viewPath.slot.val(sysview.highlightedMio);
        sysviewModal_viewPath.viewBtn.click();
    }
});

// Handles when a menu item is clicked on a port right click menu
$(".sysview_actList > li").click(function(){
    if($(this).hasClass('disableAction')){
        return;
    }
    else {
        if($(this).text() == 'VIEW_CKID') {  
            sysviewModal_ckidSearch.queryByCkid(sysview.portPicked.ckid);
        }
        else if($(this).text() == 'MAP') {        
            sysview.portAct = 'MAP';
            pmModal.clearForm(); 
            pmModal.enableFacForm();
            sysview.populateMapForm();
            pmModal.submitBtn.prop('disabled',false);
            pmModal.displayTbl.show();
            pmModal.queryAvailFac();
            pmModal.modal.modal();
        }
        else if($(this).text() == 'UNMAP') {
            
            sysview.portAct = 'UNMAP';
            pmModal.clearForm(); 
            pmModal.disableFacForm();
            sysview.populateMapForm();
            pmModal.submitBtn.prop('disabled',false);
            pmModal.displayTbl.hide();
            pmModal.modal.modal();
          
               

        }
        else if($(this).text() == 'SET_RESERVED') {
            sysview.startShowMap();
          
            sysviewModal.act.val('SET_RS');
            sysviewModal.modal.modal();       

        }
        else if($(this).text() == 'SET_DEFECTED') {
            sysview.startShowMap();
 
            sysviewModal.act.val('SET_DF');
            sysviewModal.modal.modal();  
        }
        else if($(this).text() == 'SET_SF') {
            sysview.startShowMap();
 
            sysviewModal.act.val('SET_SF');
            sysviewModal.modal.modal();  
        }

        else if($(this).text() == 'MTC_DISCON') {
            sysview.queryConnByCkid(sysview.portPicked.ckid, 'MTC_DISCON');
            sysview.portAct = 'MTC_DISCON';
        }
        else if($(this).text() == 'MTC_CONN') {
            sysview.queryConnByCkid(sysview.portPicked.ckid, 'MTC_CONN');
            sysview.portAct = 'MTC_CONN';
        }
        else if($(this).text() == 'MTC_RESTORE') {
            sysview.queryConnByCkid(sysview.portPicked.ckid, 'MTC_RESTORE');
            sysview.portAct = 'MTC_RESTORE';
        }
        else if($(this).text() == 'RESTORE_MTCD') {
            sysview.queryConnByCkid(sysview.portPicked.ckid, 'RESTORE_MTCD');
            sysview.portAct = 'RESTORE_MTCD';
        }
        else if($(this).text() == 'MTC_TEST') {
            // sysview.queryConnByCkid(sysview.portPicked.ckid, 'MTC_DISCON');
            // sysview.portAct = 'MTC_DISCON';
        }
    }
});


////-----------------solve the problem of display multiple contextmenus---------------
$(document).on('contextmenu click',function(evt){ 
  
    if($(evt.target).closest(".addPortStyle").length ==0) {
        sysview.portMenu.hide();
    }
    if($(evt.target).closest(".addNodeStyle").length ==0) {
        sysview.nodeMenu.hide();
    }
    if($(evt.target).closest(".addMioStyle").length ==0) {
        sysview.mioMenu.hide();
    }
});

///--------------submit button event for act: set_reserved, set_defected
sysviewModal.submitBtn.click(function(){

    if(sysviewModal.act.val() == "SET_RS") {
        sysviewModal.submit.updateStatPort("SET_RS");
    }
    else if(sysviewModal.act.val() == "SET_DF") {
        sysviewModal.submit.updateStatPort("SET_DF");
    }
    else if(sysviewModal.act.val() == "SET_SF") {
        sysviewModal.submit.updateStatPort("SET_SF");
    }
    
});

sysviewNodeModal.submitBtn.click(function(){
    if (sysviewNodeModal.act.val() == "LCK_NODE") {
        sysviewNodeModal.submit.lockNode();
        sysviewNodeModal.modal.modal("hide");
        alert(sysviewNodeModal.act.val() + " in progress...", null, false);
    }
    else if (sysviewNodeModal.act.val() == "UN-LCK_NODE") {
        sysviewNodeModal.submit.unlockNode();
        sysviewNodeModal.modal.modal("hide");
        alert(sysviewNodeModal.act.val() + " in progress...", null, false);
    }
    else if (sysviewNodeModal.act.val() == "DISCOVER_NODE") {
        sysviewNodeModal.submit.discoverNode();
        sysviewNodeModal.modal.modal("hide");
        alert(sysviewNodeModal.act.val() + " in progress...", null, false);
    }
    else if (sysviewNodeModal.act.val() == "START_NODE") {
        sysviewNodeModal.submit.startNode();
    }
    else if (sysviewNodeModal.act.val() == "STOP_NODE") {
        sysviewNodeModal.submit.stopNode();
    }
});

sysviewMxcModal.submitBtn.click(function() {
    if (sysviewMxcModal.act.val() == "LCK") {
        sysviewMxcModal.submit('lck');
    } 
    else if (sysviewMxcModal.act.val() == "UN-LCK") {
        sysviewMxcModal.submit('unlck');
    } 
});

sysviewModal_facSearch.facSearchBtn.on("click", function() {
    sysviewModal_facSearch.query(sysviewModal_facSearch.fac.val());
});

// SYSVIEWMODAL_CKIDSEARCH_MODAL CKCON TABLE

$(document).on("click","#sysviewModal_ckidSearch_tbl tr",function(){
    var dataRow= $(this).children("td").map(function(){
        return $(this).text();
    }).get();

    // Locate ports associated with ckcon on X side
    sysviewModal_facSearch.query(dataRow[4]);
    // Locate ports associated with ckcon on Y side
    sysviewModal_facSearch.query(dataRow[7]);

    
    //Add color to the row
    $(this).addClass("addColor"); //add class selected to current clicked row
    $(this).siblings().removeClass( "addColor" ); //remove class selected from rest of the rows  

    sysviewModal.modal.modal('hide');
});

sysviewModal_ckidSearch.ckidSearchBtn.click(function() {
    sysviewModal_ckidSearch.queryByCkid(sysviewModal_ckidSearch.ckid.val());
});

sysviewModal_viewPath.viewBtn.click(function() {
    sysviewModal_viewPath.queryByNode();
});

// SysviewCmdModal table
$(document).on('click', "#sysviewCmdModal_tbl tr", function() {
    var dataRow = $(this).children('td').map(function() {
        return $(this).text();
    }).get();

    sysviewCmdModal.ackid.val(dataRow[0]);
    sysviewCmdModal.cmd.val(dataRow[1]);
    sysviewCmdModal.stat.val(dataRow[2]);

    //Add color to the row
    $(this).addClass("addColor"); //add class selected to current clicked row
    $(this).siblings().removeClass( "addColor" ); //remove class selected from rest of the rows  
});

sysviewCmdModal.submitBtn.click(function() {
    if (sysviewCmdModal.stat.val() == "PENDING") {
        sysviewCmdModal.exec_cmd();
    }
    else {
        alert("STAT MUST BE PENDING");
    }
});
</script>